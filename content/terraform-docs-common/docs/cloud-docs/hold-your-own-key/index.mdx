---
page_title: Encrypt your state and plan files
description: |-
  Hold your own key lets you authenticate a key management system with HCP Terraform to encrypt HCP Terraform state and plan data with a key that you control.
tfc_only: true
â€”--

# Encrypt your state and plan files

Hold your own key is a [Premium Tier](https://www.hashicorp.com/en/pricing?tab=terraform) feature that gives users the ability to provide and control an encryption key that is used to secure sensitive artifacts produced by Terraform and stored within HCP Terraform.

## Introduction

Hold your own key (HYOK) gives users more control over their sensitive data by allowing users to provide their own encryption key to safeguard their most sensitive data.

HCP Terraform is responsible for storing the artifacts from Terraform runs it orchestrates, such as plan and state files. These artifacts can contain sensitive information, such as resource IDs, IP addresses, credentials, and other configuration details used to manage infrastructure. To secure this data, HCP Terraform encrypts these files before storage using a key managed by Hashicorp.

For most users this provides sufficient security. However, since HCP Terraform is responsible for this encryption, it maintains access to the artifacts, and users cannot monitor or revoke this access. This may be insufficient for compliance requirements mandating that customers retain control of the keys used to secure their sensitive data.

Hold your own key allows customers to retain control of the encryption keys used to secure their data through the use of a key management system (KMS), which HCP Terraform uses to encrypt and decrypt the keys it uses to encrypt data within state and plan files, thereby enhancing security and compliance for HCP Terraform users.

When hold your own key is enabled, the [HCP Terraform agent](/terraform/cloud-docs/agents) will secure certain artifacts produced by the Terraform CLI using a key you control before they are uploaded to HCP Terraform for storage. To accomplish this, the HCP Terraform agent authenticates with your key management service, and encrypts artifacts produced by the Terraform CLI as needed. You can run the HCP Terraform agent on your own infrastructure, meaning that neither your key, nor unencrypted secrets will be uploaded to HCP Terraform, and no out-of-network traffic needs to connect to your key management service.

The artifacts that HCP Terraform agents encrypt with hold your own key are:

- [State files](/terraform/language/state) and [JSON state files](/terraform/internals/json-format).
- [Plan files](/terraform/cli/commands/plan#out-filename) and [JSON plan files](/terraform/internals/json-format#plan-representation).

Hold your own key supports the following key management services:

- AWS KMS
- Azure Key Vault
- Google Cloud KMS
- Vault Transit Secrets Engine

Hold your own key also produces sanitized versions of sensitive artifacts that redact secrets from the artifacts. Sanitized state and plan files allow HCP Terraform to continue running policy checks, run tasks, cost estimation, and assessments without needing to access sensitive data.

Refer to [How hold your own key works](/terraform/cloud-docs/hold-your-own-key/concepts) to learn more.

## Workflow

To create a key configuration for hold your own key, you must perform the following steps:

1. Configure your key management system to accept the necessary OIDC requests from HCP Terraform, and create a key.
3. Configure the key in HCP Terraform.
4. Enable HYOK on your workspaces.

### Configure your KMS and create a key

First, [configure your KMS](/terraform/cloud-docs/hold-your-own-key/configure#create-key-configuration) to accept OIDC requests from HCP Terraform.

Then, set up your keys and grant the necessary roles and permissions in your KMS. Configuration instructions differ between cloud providers.

### Configure the key in HCP Terraform

Once your KMS has been configured with the necessary OIDC trust relationship to HCP Terraform, and you have created a key, [create an HYOK Configuration](/terraform/cloud-docs/hold-your-own-key/configure#configure-hyok-in-hcp-terraform) for your HCP Terraform organization.

Configuration varies based on your chosen KMS, but in general you will create an "HYOK Configuration" which configures the following in HCP Terraform:

- How to authenticate to your KMS via OIDC.
- Which key from your KMS HCP Terraform will use.
- What name should be used to identify the configuration within HCP Terraform.

After you have configured a key, HCP Terraform will automatically test that it can be used to secure your data.

### Enable HYOK on your workspaces

Once you have configured a key in HCP Terraform, you can begin to enable hold your own key on your workspaces.

You will choose one key to be your primary configuration. Your primary configuration will automatically be used to secure workspaces when hold your own key is enabled.

Workspace administrators can choose to enable hold your own key for their workspace. When they do, the HCP Terraform agent will generate a new Data Encryption Key (DEK) for the workspace and use your KMS to encrypt it with the KEK key specified in your primary HYOK configuration. Going forward, HCP Terraform will use this DEK to automatically encrypt all sensitive Terraform artifacts for that workspace.

<Note>

  Once you enable HYOK for a workspace, it cannot be reverted to a non-HYOK workspace.

</Note>
