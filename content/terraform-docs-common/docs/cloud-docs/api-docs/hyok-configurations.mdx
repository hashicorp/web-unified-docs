---
page_title: /hyok-configurations API reference for HCP Terraform
description: >-
 Use the HCP Terraform API's `/hyok-configurations` endpoint to read, create, fetch, test, and delete HYOK (hold your own keys) configurations.
---

[200]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200

[201]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/201

[202]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/202

[204]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204

[400]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

[401]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

[403]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403

[404]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

[409]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/409

[412]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/412

[422]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422

[429]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429

[500]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500

[504]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/504

[JSON API document]: /terraform/cloud-docs/api-docs#json-api-documents

[JSON API error object]: https://jsonapi.org/format/#error-objects

# HYOK Configurations API reference

## Attributes
Hold Your Own Keys (HYOK) configurations are a feature of HCP Terraform that allow you to point to your own encryption keys stored in a key management service that are used to encrypt Terraform artifacts on an TFC Agent running in your network.

| Attribute                        | Description                                                                                                                                                                                                                                                                  |
| -------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `name`                           | Label for the HYOK configuration to be used with HCP Terraform                                                                                               |
| `kek-id`                         | Reference to                                                                                                 |
| `kms-options`                    | Optional object used to specify [additional fields](/terraform/cloud-docs/api-docs/hyok-configurations#kms-options) for some key management services. Fields include `key_region`, `key_location`, and `key_ring_id`.  |
| `primary`                        | Boolean flag that indicates whether this HYOK Configuration should be used for HYOK encryption of Terraform artifacts.                                                                                             |
| `status`                         | Indicates a HYOK configuration [status](/terraform/cloud-docs/api-docs/hyok-configurations#hyok-configuration-status). This status can be `active`, `testing`, `test_failed`, `available`, `revoking`, or `revoked`. |
| `error`                          | A supplementary error message that provides additional context when the `status` is `errored` or `test_failed`.                                                                            |

### HYOK Configuration Status
The HYOK configuration status is found in `data.attributes.status`, and you can reference the following list of possible statuses.

| State | Description |
| --- | --- |
| `available` | Indicates that the HYOK configuration has been tested and is ready to be used for encryption. |
| `testing` | Indicates that the HYOK configuration is currently in the process of testing whether your key encryption key can be used to encrypt and decrypt data. |
| `test_failed`  | Indicates that the HYOK configuration was not able to be used fetch your key encryption key and use it to encrypt and decrypt data |
| `revoked`  | Indicates that the HYOK configuration was successfully revoked. |
| `revoking`  | Indicates that the HYOK configuration is being revoked. The data encryption key that is encrypted with your key encryption key is now being renecrypted with the key encryption key associated with your primary HYOK Configuration.|

### KMS Options
The HYOK configuration status is found in `data.attributes.kms-options`, and you can reference the following list of possible options.

| Option | Description |
| --- | --- |
| `key_region` | The AWS region where your key is located. |
| `key_location` | A key ring is the root resource for Google Cloud KMS keys and key versions. Each key ring exists within a given location  |
| `key_ring_id` | A key ring is the root resource for Google Cloud KMS keys and key versions. Each key ring exists within a given location |

## Create an HYOK Configuration
 POST /organizations/:organization_name/hyok-configurations

| Parameter       | Description                                                                                                                                                                                                       |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `:workspace_id` | The workspace ID to create the new HYOK configuration in. Obtain this from the [workspace settings](/terraform/cloud-docs/workspaces/settings) or the [Show Workspace](/terraform/cloud-docs/api-docs/workspaces#show-workspace) endpoint. |

Creates an HYOK Configuration.

| Status  | Response                  | Reason                                                            |
|---------|---------------------------|-------------------------------------------------------------------|
| [201][] | [JSON API document][]     | Successfully created a HYOK configuration.                        |
| [404][] | [JSON API error object][] | Workspace not found, or user unauthorized to perform action.      |
| [409][] | [JSON API error object][] | Conflict; check the error object for more information.            |
| [412][] | [JSON API error object][] | Precondition failed; check the error object for more information. |
| [422][] | [JSON API error object][] | Malformed request body (missing attributes, wrong types, etc.).   |

### Request Body

This POST endpoint requires a JSON object with the following properties as a request payload.

Properties without a default value are required.

| Key path                             | Type    | Default   | Description                                                                                                                                                                                                                                                                                |
|--------------------------------------|---------|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `data.type`                          | string  |           | Must be `"hyok-configurations"`.                                                                                                                                                                                                                                                                |
| `data.attributes.serial`             | integer |           | The serial of the HYOK configuration. Must match the serial value extracted from the raw state file.                                                                                                                                                                                            |
| `data.attributes.md5`                | string  |           | An MD5 hash of the raw HYOK configuration.                                                                                                                                                                                                                                                       |
| `data.attributes.state`              | string  | (nothing) | **Optional** Base64 encoded raw state file. If omitted, you must use the upload method below to complete the HYOK configuration creation. The workspace may not be unlocked normally until the HYOK configuration is uploaded.                                                                                                                                                                                                                                                              |
| `data.attributes.lineage`            | string  | (nothing) | **Optional** Lineage of the HYOK configuration. Should match the lineage extracted from the raw state file. Early versions of terraform did not have the concept of lineage, so this is an optional attribute.                                                                                  |
| `data.attributes.json-state`         | string  | (nothing) | **Optional** Base64 encoded json state, as expressed by `terraform show -json`. See [JSON Output Format](/terraform/internals/json-format) for more details.                                                                                                                                          |
| `data.attributes.json-state-outputs` | string  | (nothing) | **Optional** Base64 encoded output values as represented by `terraform show -json` (the contents of the values/outputs key). If provided, the workspace outputs populate immediately. If omitted, HCP Terraform populates the workspace outputs from the given state after a short time. |
| `data.relationships.run.data.id`     | string  | (nothing) | **Optional** The ID of the run to associate with the HYOK configuration.                                                                                                                                                                                                                        |

### Sample Payload

```json
{
  "data": {
    "attributes": {
      "name": "my-key-name",
      "primary": false,
      "kek-id": "key1",
      "status": null,
      "error": null,
      "kms-options": {}
    },
    "relationships": {
      "organization": {
        "data": {
          "type": "organizations",
          "id": "dretli-hyok-org"
        }
      },
      "agent-pool": {
        "data": {
          "type": "agent-pools",
          "id": "apool-MFtsuFxHkC9pCRgB"
        }
      },
      "oidc-configuration": {
        "data": {
          "type": "vault-oidc-configurations",
          "id": "voidc-dMuFy6AKrawNVBJY"
        }
      }
    },
    "type": "hyok-configurations"
  }
}
```

### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request POST \
  --data @payload.json \
  https://app.terraform.io/api/v2/organizations/dretli-hyok-org/hyok-configurations
```

### Sample Response

```json
{
    "data": {
        "id": "hyokc-L4CxAJEEn8vEUEkj",
        "type": "hyok-configurations",
        "attributes": {
            "kek-id": "key1",
            "kms-options": {},
            "name": "my-key-name",
            "primary": false,
            "status": "untested",
            "error": null
        },
        "relationships": {
            "organization": {
                "data": {
                    "id": "dretli-hyok-org",
                    "type": "organizations"
                }
            },
            "oidc-configuration": {
                "data": {
                    "id": "voidc-dMuFy6AKrawNVBJY",
                    "type": "vault-oidc-configurations"
                }
            },
            "agent-pool": {
                "data": {
                    "id": "apool-MFtsuFxHkC9pCRgB",
                    "type": "agent-pools"
                }
            },
            "hyok-customer-key-versions": {
                "data": []
            }
        }
    }
}
```

## List HYOK Configurations for an Organization
 GET /api/v2/organizations/:organization_name/hyok-configuration

### Query Parameters

This endpoint supports pagination [with standard URL query parameters](/terraform/cloud-docs/api-docs#query-parameters). Remember to percent-encode `[` as `%5B` and `]` as `%5D` if your tooling doesn't automatically encode URLs.

| Parameter                    | Description                                                                            |
|------------------------------|----------------------------------------------------------------------------------------|
| `filter[organization][name]` | **Required** The name of the organization that owns the desired workspace.             |
| `page[number]`               | **Optional.** If omitted, the endpoint will return the first page.                     |
| `page[size]`                 | **Optional.** If omitted, the endpoint will return 20 HYOK configurations per page.         |

### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request GET \
  --data @payload.json \
  https://app.terraform.io/api/v2/organizations/:organization_name/hyok-configuration
```

### Sample Response

```json
{
    "data": [
        {
            "id": "hyokc-B4ae7Tzsy52QzMTA",
            "type": "hyok-configurations",
            "attributes": {
                "kek-id": "tf-rocket-hyok-oasis",
                "kms-options": {},
                "name": "tf-rocket-hyok-oasis",
                "primary": true,
                "status": "test_failed",
                "error": "Error forwarding request:: Unexpected response from broker: Status code: 424, Message: Failed Dependency, Organization ID: org-y1xsQ1LBbqpDHiMv, Agent Pool ID: apool-MFtsuFxHkC9pCRgB, Organization ID: org-y1xsQ1LBbqpDHiMv, Agent Pool ID: apool-MFtsuFxHkC9pCRgB"
            },
            "relationships": {
                "organization": {
                    "data": {
                        "id": "dretli-hyok-org",
                        "type": "organizations"
                    }
                },
                "oidc-configuration": {
                    "data": {
                        "id": "voidc-dMDwrVdzxbWZcjPf",
                        "type": "vault-oidc-configurations"
                    }
                },
                "agent-pool": {
                    "data": {
                        "id": "apool-MFtsuFxHkC9pCRgB",
                        "type": "agent-pools"
                    }
                },
                "hyok-customer-key-versions": {
                    "data": [
                        {
                            "id": "keyv-PJJ5biGx2xGmk1ko",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-mdcFMe2pFHxqTSBq",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-emT4uwmo1B8B81Jt",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-UuRchWcL9fqadq2F",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-tpY5A8Vm883sp9jZ",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-TeELFNmCqpaQ5dNa",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-BeMwZesoPGs3tpNq",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-dLG62jSsAq6o4f8V",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-DjDqHppkyyQ4fgcd",
                            "type": "hyok-customer-key-versions"
                        },
                        {
                            "id": "keyv-pc9SqwDWFkuaYath",
                            "type": "hyok-customer-key-versions"
                        }
                    ]
                }
            }
        },
        {
            "id": "hyokc-L4CxAJEEn8vEUEkj",
            "type": "hyok-configurations",
            "attributes": {
                "kek-id": "key1",
                "kms-options": {},
                "name": "my-key-name",
                "primary": false,
                "status": "test_failed",
                "error": "No Agents are available for request forwarding: Agent Pool ID: apool-MFtsuFxHkC9pCRgB, Organization ID: org-y1xsQ1LBbqpDHiMv,"
            },
            "relationships": {
                "organization": {
                    "data": {
                        "id": "dretli-hyok-org",
                        "type": "organizations"
                    }
                },
                "oidc-configuration": {
                    "data": {
                        "id": "voidc-dMuFy6AKrawNVBJY",
                        "type": "vault-oidc-configurations"
                    }
                },
                "agent-pool": {
                    "data": {
                        "id": "apool-MFtsuFxHkC9pCRgB",
                        "type": "agent-pools"
                    }
                },
                "hyok-customer-key-versions": {
                    "data": []
                }
            }
        },
        {
            "id": "hyokc-tPLXkKbURnrVvMFs",
            "type": "hyok-configurations",
            "attributes": {
                "kek-id": "tf-rocket-hyok-oasis",
                "kms-options": {},
                "name": "whatever-testing2",
                "primary": false,
                "status": "test_failed",
                "error": "Error on agent: error creating kms client: Put \"https://dretli-vault-cluster-public-vault-659decf3.b8298d98.z1.hashicorp.cloud:8200/v1/auth/jwt/login\": dial tcp: lookup dretli-vault-cluster-public-vault-659decf3.b8298d98.z1.hashicorp.cloud on 127.0.0.11:53: no such host"
            },
            "relationships": {
                "organization": {
                    "data": {
                        "id": "dretli-hyok-org",
                        "type": "organizations"
                    }
                },
                "oidc-configuration": {
                    "data": {
                        "id": "voidc-Tje2BewrPfi5gthY",
                        "type": "vault-oidc-configurations"
                    }
                },
                "agent-pool": {
                    "data": {
                        "id": "apool-MFtsuFxHkC9pCRgB",
                        "type": "agent-pools"
                    }
                },
                "hyok-customer-key-versions": {
                    "data": [
                        {
                            "id": "keyv-bUW9Za7LfRStunTp",
                            "type": "hyok-customer-key-versions"
                        }
                    ]
                }
            }
        }
    ],
    "links": {
        "self": "https://tfcdev-f3054ebe.ngrok.app/api/v2/organizations/dretli-hyok-org/hyok-configurations?organization_name=dretli-hyok-org\u0026page%5Bnumber%5D=1\u0026page%5Bsize%5D=20",
        "first": "https://tfcdev-f3054ebe.ngrok.app/api/v2/organizations/dretli-hyok-org/hyok-configurations?organization_name=dretli-hyok-org\u0026page%5Bnumber%5D=1\u0026page%5Bsize%5D=20",
        "prev": null,
        "next": null,
        "last": "https://tfcdev-f3054ebe.ngrok.app/api/v2/organizations/dretli-hyok-org/hyok-configurations?organization_name=dretli-hyok-org\u0026page%5Bnumber%5D=1\u0026page%5Bsize%5D=20"
    },
    "meta": {
        "pagination": {
            "current-page": 1,
            "page-size": 20,
            "prev-page": null,
            "next-page": null,
            "total-pages": 1,
            "total-count": 15
        }
    }
}
```


## Show HYOK Configuration
 GET /api/v2/hyok-configurations/:external_id

### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request GET \
  --data @payload.json \
  https://app.terraform.io/api/v2/hyok-configurations/:external_id
```

### Sample Response

```json
{
    "data": {
        "id": "hyokc-WvptL89g24ixsaVk",
        "type": "hyok-configurations",
        "attributes": {
            "kek-id": "tf-rocket-hyok-oasis",
            "kms-options": {},
            "name": "testingbrother",
            "primary": false,
            "status": "untested",
            "error": null
        },
        "relationships": {
            "organization": {
                "data": {
                    "id": "dretli-hyok-org",
                    "type": "organizations"
                }
            },
            "oidc-configuration": {
                "data": {
                    "id": "voidc-QPuDM2pjRRr3yYkh",
                    "type": "vault-oidc-configurations"
                }
            },
            "agent-pool": {
                "data": {
                    "id": "apool-MFtsuFxHkC9pCRgB",
                    "type": "agent-pools"
                }
            },
            "hyok-customer-key-versions": {
                "data": []
            }
        }
    }
}
```


## Revoke HYOK Configuration
 POST /api/v2/hyok-customer-key-versions/:external_id/actions/revoke

| Status  | Response                  | Reason                                                            |
|---------|---------------------------|-------------------------------------------------------------------|
| [204][] | [No content][]     | Successfully revoked a HYOK configuration.                               |
| [409][] | [JSON API error object][] | Conflict; check the error object for more information.            |

### Sample Payload
```json
{}
```

### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request GET \
  --data @payload.json \
  https://app.terraform.io/api/v2/hyok-customer-key-versions/:external_id/actions/revoke
```

### Sample Response

```text
HTTP/1.1 204 No Content
Content-Length: 0
```









## Delete HYOK Configuration
 DELETE /api/v2/hyok-configurations/:external_id

| Status  | Response                  | Reason                                                            |
|---------|---------------------------|-------------------------------------------------------------------|
| [204][] | [No content][]            | Successfully revoked a HYOK configuration.                        |


### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request DELETE \
  --data @payload.json \
  https://app.terraform.io/api/v2/hyok-configurations/:external_id
```

### Sample Response

```text
HTTP/1.1 204 No Content
Content-Length: 0
```




## Test Persisted HYOK Configuration
 POST /api/v2/hyok-configurations/:external_id/actions/test

| Status  | Response                  | Reason                                                            |
|---------|---------------------------|-------------------------------------------------------------------|
| [204][] | [No content][]            | Successfully tested a HYOK configuration.                        |

### Sample Payload
```json
{}
```

### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request DELETE \
  --data @payload.json \
  https://app.terraform.io/api/v2/hyok-configurations/:external_id/actions/test
```

### Sample Response

```text
HTTP/1.1 204 No Content
Content-Length: 0
```






## Test Persisted HYOK Configuration
 POST /api/v2/hyok-configurations/:external_id/actions/test

| Status  | Response                  | Reason                                                            |
|---------|---------------------------|-------------------------------------------------------------------|
| [204][] | [No content][]            | Successfully tested a HYOK configuration.                        |

### Sample Payload
```json
{}
```

### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request DELETE \
  --data @payload.json \
  https://app.terraform.io/api/v2/hyok-configurations/:external_id/actions/test
```

### Sample Response

```text
HTTP/1.1 204 No Content
Content-Length: 0
```




## Test Unpersisted HYOK Configuration
 POST /api/v2/organizations/:organization_name/hyok-configurations/test

| Status  | Response                  | Reason                                                            |
|---------|---------------------------|-------------------------------------------------------------------|
| [204][] | [No content][]            | Successfully tested a HYOK configuration.                        |

### Sample Payload
```json
{
  "hyok-configuration": {
    "data": {
      "attributes": {
        "name": "hyok-config-name",
        "primary": false,
        "kek-id": "keyname1",
        "status": null,
        "error": null,
        "kms-options": {}
      },
      "relationships": {
        "organization": {
          "data": {
            "type": "organizations",
            "id": "dretli-hyok-org"
          }
        },
        "agent-pool": {
          "data": {
            "type": "agent-pools",
            "id": "apool-MFtsuFxHkC9pCRgB"
          }
        }
      },
      "type": "hyok-configurations"
    }
  },
  "oidc-configuration": {
    "data": {
      "attributes": {
        "address": "https://dretli-vault-cluster-public-vault-659decf3.b8298d98.z1.hashicorp.cloud:8200",
        "role": "tf-rocket-hyok-role-oasis",
        "namespace": "admin",
        "auth-path": "jwt",
        "encoded-cacert": null
      },
      "relationships": {
        "organization": {
          "data": {
            "type": "organizations",
            "id": "dretli-hyok-org"
          }
        }
      },
      "type": "vault-oidc-configurations"
    }
  }
}
```

### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request DELETE \
  --data @payload.json \
  https://app.terraform.io/api/v2/organizations/:organization_name/hyok-configurations/test
```

### Sample Response

```text
HTTP/1.1 204 No Content
Content-Length: 0
```
