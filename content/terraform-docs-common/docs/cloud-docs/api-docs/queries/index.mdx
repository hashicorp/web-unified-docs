---
page_title: /queries API reference for HCP Terraform
description: Use the HCP Terraform API's `/queries` to create and manage Query Runs.
tfc_only: true
---

[200]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200

[201]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/201

[202]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/202

[204]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204

[400]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

[401]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

[403]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403

[404]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

[409]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/409

[412]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/412

[422]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422

[429]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429

[500]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500

[504]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/504

[JSON API document]: /terraform/cloud-docs/api-docs#json-api-documents

[JSON API error object]: http://jsonapi.org/format/#error-objects

# Query API reference

Queries let you execute queries against your HCP Terraform workspaces to retrieve information about workspace resources and configurations. Query runs are asynchronous operations that can be monitored for status and results.

## Overview

The scope of the API includes the following endpoints:

| Method   | Path                                              | Action                                                                                                     |
|----------|-------------------------------------------------- |------------------------------------------------------------------------------------------------------------|
| `POST`   | `/queries`                                        | Call this endpoint to [create a Query Run](#create-a-query-run).                                          |
| `GET`    | `/queries/:query_id`                              | Call this endpoint to [show a Query Run](#show-a-query-run).                                              |
| `POST`   | `/queries/:query_id/actions/cancel`               | Call this endpoint to [cancel a Query Run](#cancel-a-query-run).                                          |
| `GET`    | `/workspaces/:workspace_id/queries`               | Call this endpoint to [list Query Runs for a Workspace](#list-query-runs-for-a-workspace).                |

## Create a Query Run

This endpoint creates a new query run.

`POST /queries`

| Status  | Response                  | Reason                                                                |
|---------|---------------------------|-----------------------------------------------------------------------|
| [201][] | [JSON API document][]     | Successfully created a Query Run.                                     |
| [404][] | [JSON API error object][] | Not found, or the user is unauthorized to perform this action.        |
| [422][] | [JSON API error object][] | Malformed request body (e.g., missing attributes, wrong types, etc.). |
| [500][] | [JSON API error object][] | Internal system failure.                                              |


### Request Body

This POST endpoint requires a JSON object with the following properties as a request payload.

Properties without a default value are required.

| Key path                                          | Type    | Default          | Description                                                                                                 |
|---------------------------------------------------|---------|------------------|-------------------------------------------------------------------------------------------------------------|
| `data.type`                                       | string  |                  | Must be `"queries"`.                                                                                        |
| `data.attributes.source`                          | string  |                  | The source of the query (e.g., query content or reference).                                                |
| `data.relationships.workspace.data.type`          | string  |                  | Must be `"workspaces"`.                                                                                     |
| `data.relationships.workspace.data.id`            | string  |                  | The ID of the workspace to run the query against.                                                          |
| `data.relationships.configuration-version.data.type` | string |               | Must be `"configuration-versions"`.                                                                         |
| `data.relationships.configuration-version.data.id`   | string |               | The ID of the configuration version to use for the query.                                                  |

### Sample Payload

```json
{
  "data": {
    "type": "queries",
    "attributes": {
      "source": "example-query-content"
    },
    "relationships": {
      "workspace": {
        "data": {
          "type": "workspaces",
          "id": "ws-ABC123"
        }
      },
      "configuration-version": {
        "data": {
          "type": "configuration-versions",
          "id": "cv-XYZ789"
        }
      }
    }
  }
}
```

### Sample Request

```shell
$ curl\
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request POST \
  --data @payload.json \
  https://app.terraform.io/api/v2/queries
```

### Sample Response

```json
{
  "data": {
    "id": "query-ABC123",
    "type": "queries",
    "attributes": {
      "source": "example-query-content",
      "status": "pending",
      "created-at": "2025-01-15T10:30:00.000Z",
      "updated-at": "2025-01-15T10:30:00.000Z",
      "canceled-at": null,
      "log-read-url": "https://archivist.terraform.io/v1/object/...",
      "force-cancel-available-at": null,
      "status-timestamps": {
        "pending-at": "2025-01-15T10:30:00.000Z",
        "queued-at": null,
        "running-at": null,
        "finished-at": null,
        "errored-at": null,
        "canceled-at": null
      },
      "actions": {
        "is-cancelable": true,
        "is-force-cancelable": false
      },
      "permissions": {
        "can-cancel": true,
        "can-force-cancel": false
      }
    },
    "relationships": {
      "workspace": {
        "data": {
          "type": "workspaces",
          "id": "ws-ABC123"
        }
      },
      "configuration-version": {
        "data": {
          "type": "configuration-versions",
          "id": "cv-XYZ789"
        }
      },
      "created-by": {
        "data": {
          "type": "users",
          "id": "user-123"
        }
      },
      "canceled-by": {
        "data": null
      }
    },
    "links": {
      "self": "/api/v2/queries/query-ABC123"
    }
  }
}
```

## List Query Runs for a Workspace

This endpoint lists Query Runs for a particular workspace.

`GET /workspaces/:workspace_id/queries`

| Parameter        | Description                                           |
|------------------|-------------------------------------------------------|
| `:workspace_id`  | The ID of the workspace to list Query Runs for.      |

### Query Parameters

This endpoint supports pagination [with standard URL query parameters](/terraform/cloud-docs/api-docs#query-parameters); remember to percent-encode `[` as `%5B` and `]` as `%5D` if your tooling doesn't automatically encode URLs.

| Parameter      | Description                                                                  |
|----------------|------------------------------------------------------------------------------|
| `page[number]` | **Optional.** If omitted, the endpoint will return the first page.          |
| `page[size]`   | **Optional.** If omitted, the endpoint will return 20 Query Runs per page.  |

| Status  | Response                  | Reason                                                         |
|---------|---------------------------|----------------------------------------------------------------|
| [200][] | [JSON API document][]     | Successfully retrieved the list of Query Runs.                 |
| [404][] | [JSON API error object][] | Not found, or the user is unauthorized to perform this action. |

### Sample Request

```shell
$ curl\
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  https://app.terraform.io/api/v2/workspaces/ws-ABC123/queries
```

### Sample Response

```json
{
  "data": [
    {
      "id": "query-ABC123",
      "type": "queries",
      "attributes": {
        "source": "example-query-content",
        "status": "finished",
        "created-at": "2025-01-15T10:30:00.000Z",
        "updated-at": "2025-01-15T10:35:00.000Z",
        "canceled-at": null,
        "log-read-url": "https://archivist.terraform.io/v1/object/...",
        "force-cancel-available-at": null,
        "status-timestamps": {
          "pending-at": "2025-01-15T10:30:00.000Z",
          "queued-at": "2025-01-15T10:30:05.000Z",
          "running-at": "2025-01-15T10:30:10.000Z",
          "finished-at": "2025-01-15T10:35:00.000Z",
          "errored-at": null,
          "canceled-at": null
        },
        "actions": {
          "is-cancelable": false,
          "is-force-cancelable": false
        },
        "permissions": {
          "can-cancel": false,
          "can-force-cancel": false
        }
      },
      "relationships": {
        "workspace": {
          "data": {
            "type": "workspaces",
            "id": "ws-ABC123"
          }
        },
        "configuration-version": {
          "data": {
            "type": "configuration-versions",
            "id": "cv-XYZ789"
          }
        },
        "created-by": {
          "data": {
            "type": "users",
            "id": "user-123"
          }
        },
        "canceled-by": {
          "data": null
        }
      },
      "links": {
        "self": "/api/v2/queries/query-ABC123"
      }
    }
  ],
  "links": {
    "self": "https://app.terraform.io/api/v2/workspaces/ws-ABC123/queries?page%5Bnumber%5D=1&page%5Bsize%5D=20",
    "first": "https://app.terraform.io/api/v2/workspaces/ws-ABC123/queries?page%5Bnumber%5D=1&page%5Bsize%5D=20",
    "prev": null,
    "next": null,
    "last": "https://app.terraform.io/api/v2/workspaces/ws-ABC123/queries?page%5Bnumber%5D=1&page%5Bsize%5D=20"
  },
  "meta": {
    "pagination": {
      "current-page": 1,
      "page-size": 20,
      "prev-page": null,
      "next-page": null,
      "total-pages": 1,
      "total-count": 1
    }
  }
}
```

## Show a Query Run

This endpoint shows details for a specific Query Run.

`GET /queries/:query_id`

| Parameter   | Description                              |
|-------------|------------------------------------------|
| `:query_id` | The ID of the Query Run to retrieve.     |

| Status  | Response                  | Reason                                                         |
|---------|---------------------------|----------------------------------------------------------------|
| [200][] | [JSON API document][]     | Successfully retrieved the Query Run.                          |
| [404][] | [JSON API error object][] | Not found, or the user is unauthorized to perform this action. |

### Sample Request

```shell
$ curl\
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  https://app.terraform.io/api/v2/queries/query-ABC123
```

### Sample Response

```json
{
  "data": {
    "id": "query-ABC123",
    "type": "queries",
    "attributes": {
      "source": "example-query-content",
      "status": "running",
      "created-at": "2025-01-15T10:30:00.000Z",
      "updated-at": "2025-01-15T10:30:15.000Z",
      "canceled-at": null,
      "log-read-url": "https://archivist.terraform.io/v1/object/...",
      "force-cancel-available-at": "2025-01-15T10:40:00.000Z",
      "status-timestamps": {
        "pending-at": "2025-01-15T10:30:00.000Z",
        "queued-at": "2025-01-15T10:30:05.000Z",
        "running-at": "2025-01-15T10:30:10.000Z",
        "finished-at": null,
        "errored-at": null,
        "canceled-at": null
      },
      "actions": {
        "is-cancelable": true,
        "is-force-cancelable": false
      },
      "permissions": {
        "can-cancel": true,
        "can-force-cancel": false
      }
    },
    "relationships": {
      "workspace": {
        "data": {
          "type": "workspaces",
          "id": "ws-ABC123"
        }
      },
      "configuration-version": {
        "data": {
          "type": "configuration-versions",
          "id": "cv-XYZ789"
        }
      },
      "created-by": {
        "data": {
          "type": "users",
          "id": "user-123"
        }
      },
      "canceled-by": {
        "data": null
      }
    },
    "links": {
      "self": "/api/v2/queries/query-ABC123"
    }
  }
}
```

## Cancel a Query Run

This endpoint cancels a Query Run that is currently pending or running.

`POST /queries/:query_id/actions/cancel`

| Parameter   | Description                          |
|-------------|--------------------------------------|
| `:query_id` | The ID of the Query Run to cancel.   |

| Status  | Response                  | Reason                                                                |
|---------|---------------------------|-----------------------------------------------------------------------|
| [202][] | Empty body                | Successfully canceled the Query Run.                                  |
| [409][] | [JSON API error object][] | Failed to transition Query Run to a canceled state.                   |

### Sample Request

```shell
$ curl\
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request POST \
  https://app.terraform.io/api/v2/queries/query-ABC123/actions/cancel
```

## Query Run Attributes

Query Runs have the following attributes:

### Status

The `status` attribute indicates the current state of the Query Run. Possible values are:

- `pending` - The Query Run has been created but not yet queued for execution.
- `running` - The Query Run is currently executing.
- `finished` - The Query Run has completed successfully.
- `canceled` - The Query Run was canceled before completion.
- `errored` - The Query Run encountered an error during execution.

### Status Timestamps

The `status-timestamps` object contains timestamps for when the Query Run entered each status:

- `pending-at` - When the Query Run was created.
- `queued-at` - When the Query Run was queued for execution.
- `running-at` - When the Query Run started executing.
- `finished-at` - When the Query Run completed successfully.
- `errored-at` - When the Query Run encountered an error.
- `canceled-at` - When the Query Run was canceled.

### Actions and Permissions

The `actions` object indicates which actions can be performed on the Query Run:

- `is-cancelable` - Whether the Query Run can be canceled.
- `is-force-cancelable` - Whether the Query Run can be force-canceled.

The `permissions` object indicates which actions the current user has permission to perform:

- `can-cancel` - Whether the user can cancel the Query Run.
- `can-force-cancel` - Whether the user can force-cancel the Query Run.

### Log Read URL

The `log-read-url` attribute contains a URL to retrieve the logs for the Query Run. This URL is a signed Archivist URL that should be treated as a secret.
