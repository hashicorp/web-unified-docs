---
page_title: Configure connections to policy sets
description: >-
 Learn how to connect policy sets to your organization in HCP Terraform.
---

# Configure connections to policy sets

Policy sets are collections of policies that you can apply globally or to specific projects and workspaces. For more information about defining policies, refer to [Define policies overview](/terraform/cloud-docs/workspaces/policy-enforcement/define-policies). For information about using policies created and maintained by HashiCorp, refer to [Run pre-written Sentinel policies](/terraform/cloud-docs/workspaces/policy-enforcement/prewritten-sentinel).   

## Overview

The way you set up and configure a new policy set depends on your workflow and where you store policies. HCP Terraform and Terraform Enterprise support the following workflows:

- Managed policies: In the UI, create a policy set and add the policies.
- Policy sets hosted in a version control system: In the UI, create a policy set connected to your repository. HCP Terraform automatically refreshes the policy set when you change relevant files. Version control policy sets have specific organization and formatting requirements. Refer to [Sentinel VCS Repositories](/terraform/cloud-docs/workspaces/policy-enforcement/manage-policy-sets/sentinel-vcs) and [OPA VCS Repositories](/terraform/cloud-docs/workspaces/policy-enforcement/manage-policy-sets/opa-vcs) for details.
- For automated workflows, such as continuous deployment, you can use the UI to create an empty policy set and then call the [`/policy-sets` API endpoint](/terraform/cloud-docs/api-docs/policy-sets) to add policies. You can also use the API or the [`tfe` provider](https://registry.terraform.io/providers/hashicorp/tfe/latest/docs/resources/policy_set) to add an entire, packaged policy set.

## Requirements

To view, create, and manage policy sets, you must have [**manage policy permissions**](/terraform/cloud-docs/users-teams-organizations/permissions/organization#manage-policies) for your organization.

## View existing policy set connections

1. Sign in to [HCP Terraform](https://app.terraform.io/) or Terraform Enterprise and navigate to your organization.
1. Click **Settings**, then **Policy Sets** in the sidebar. 

This page contains all of the policy sets available in the organization, including those added through the API.

## Create a new policy set connection

1. Sign in to [HCP Terraform](https://app.terraform.io/) or Terraform Enterprise and navigate to the organization you want to create a policy set in.
1. Choose **Settings** from the sidebar, then **Policy sets**.
1. Choose one of the following sources:
   - **Version control system (VCS) provider**: Choose this option to run policy sets hosted in your VCS. This option is best for automating policy enforcement.
   - **Individually managed policies**: Choose this option to create a policy set in the UI and add individually managed policies to the set. This option is best for small teams and teams with less complex policy management requirements.
   - **Automated**: Choose this option to use the API to add policies to an empty policy set later. This option is best for advanced policy management tools or to integrate with third-party systems.
1. Click **Next**, then choose either **Sentinel** or **Open policy agent (OPA)** as the policy framework. A policy set can only contain policies that use the same framework. You cannot change a policy set's framework type after creation.
1. Specify a unique and descriptive name for the policy set. You can use any combination of letters, numbers, `-`, and `_`. A name is required.
1. It is optional, but you can add a description. We recommend adding a description so that the purpose of the policy set is clear to team members.
1. Choose a policy set scope:
   - Enable the **Policies enforced globally** option to automatically enforce this policy set on all of the organization's existing and future workspaces. You can optionally click **Add exclusions** and choose workspaces to exempt from the policy set. 
   - Enable the **Policies enforced on selected projects and workspaces** option to enforce the policy set on specific workspaces or all workspaces in project. This affects all current and future workspaces for any projects you choose.  
1. For Sentinal policy sets, choose a policy execution mode. Refer to [Policy set exeuction modes](#policy-set-exeuction-modes) for details about each option. For OPA policy sets, configure the following settings:
   - Choose an OPA version from the **Runtime version** drop-down menu.
   - Enable the **This policy set can be overridden in the event of mandatory failures** option to let users with override policy permissions apply plans, even when a mandatory policy fails. Refer to [Policy enforcement levels](/terraform/cloud-docs/workspaces/policy-enforcement/manage-policy-sets#policy-enforcement-levels) for more information.
1. Click **Next**, then configure the following settings depending on the source you chose in step 3:
   
   - **Version control system (VCS) provider**:
      1. Choose the VCS provider. Refer to [Connect to VCS](/terraform/cloud-docs/vcs) for more information.
      1. Specify the repository where the policy set is stored.
      1. If the repository contains multiple sets, specify the relative path from your root directory to the directory that contains either the `sentinel.hcl` or `policies.hcl` configuration files. By default, HCP Terraform and Terraform Enterprise use the repository's root directory.
      1. You can specify a VCS branch to import new versions of policies from. By default, HCP Terraform and Terraform Enterprise use your selected VCS repository's default branch.
   
   - **Individually managed policies**: Select managed policies from the **Policies** drop-down to add to the policy set. You can only add policies written with the same policy framework you selected for this set.

   - **Automated**: Specify a list of key-value pairs that HCP Terraform or Terraform Enterprise sends to the Sentinel runtime when performing policy checks on workspaces. Refer to [Sentinel parameters](#sentinel-parameters) for more information.

1. Click **Create policy set** to finish.

Depending on the type of policy set you choose to create, you can then add policies to the set using the UI, connected VCS repository, the API, or the `tfe` provider. If you are creating an OPA policy set or a Sentinel policy set using agents, we recommend choosing a specific runtime version for your policy set to ensure consistent behavior.

### Policy set exeuction modes

When using Sentinel as the policy framework, you can set the execution mode to either **Legacy** or **Agent** to determine the environment that policies run in.  

#### Legacy mode

When a policy run starts, the job is executed internally by the HCP Terraform or Terraform Enterprise container.
Enable legacy mode when you want to quickly start policy runs with minimal overhead. Legacy mode also supports cost estimation data in policies.

However, legacy mode does not support pinning Sentinel versions to the policy. As a result, future updates to the policy set can affect scalability for large environments. 

Additionally, legacy mode may lead to slower overall application performance during high policy run volumes. This is because the policy run shares CPU and memory allocations with the HCP Terraform or Terraform Enterprise container.

#### Agent mode

When a policy run starts, HCP Terraform or Terraform Enterprise checks the workspace settings to determine the execution environment. Refer to [Execution Mode](/terraform/cloud-docs/workspaces/settings#execution-mode) for more information about workspace execution modes.

When the workspace execution mode is also set to **Agent**, HCP Terraform or Terraform Enterprise evaluates the policy using an agent instance from the specified agent pool. The workspace can either explicitly be set to agent mode or inherit the agent execution mode from the [project settings](/terraform/cloud-docs/projects#execution-mode) or [organization settings](/terraform/cloud-docs/users-teams-organizations/organizations#organization-settings).    

When the workspace execution mode is set to **Local** or **Remote**, HCP Terraform or Terraform Enterprise starts a new agent to evaluate the policy.    

Use agent mode when you need to pin Sentinel versions to the policy, which results in greater scalability for large environments. You can also use agent mode to offload resource consumption from the HCP Terraform or Terraform Enterprise container. Because agents run in separate namespaces, Kubernetes pods, or dedicated agent pools, policy runs are isolated from the HCP Terraform or Terraform Enterprise node. 

Because the pool must dispatch an agent or potentially start an agent container, agent mode may result in slightly slower startup times. Additionally, agent mode does not support using cost estimation data in policies.

### Edit policy sets

1. Sign in to [HCP Terraform](https://app.terraform.io/) or Terraform Enterprise and navigate to the organization you want to edit a policy set in.
1. Choose **Settings** from the sidebar, then **Policies**.
1. Click the policy set you want to edit to go to its settings page.
1. Adjust the settings and click **Update policy set**.

### Evaluate a policy runtime upgrade

For OPA and Sentinel policy sets using agents, we recommend choosing a specific runtime version for your policy set to ensure consistent behavior.

<Note>

HCP Terraform and Terraform Enterprise no longer supports the `latest` tag for OPA policy sets. By default, OPA policy sets using the `latest` tag are pinned to the most recently supported version. To upgrade to a newer OPA runtime version, specify a version in your policy set settings.

</Note>

You can test a new runtime version for a policy set to ensure your policies work as expected before upgrading to that version. To test a new policy set runtime version, perform the following steps:

1. Sign in to [HCP Terraform](https://app.terraform.io/) or Terraform Enterprise and navigate to your organization.
1. Choose **Settings** from the sidebar, then **Policies** in your organization’s settings.
1. Click the policy set you want to upgrade.
1. Click the **Evaluate** tab.
1. Select the **Runtime version** you want to upgrade to.
1. Select a **Workspace** to test the policy set and upgraded version against.
1. Click **Evaluate**.

HCP Terraform executes the policy set using the specified version and the latest plan data for the specified workspace, then displays the evaluation results. If the evaluation returns a `Failed` status, inspect the JSON output to determine if the issue is related to a non-compliant resource or a syntax issue.

If the evaluation results in an error, check that the policy configuration is valid with your new runtime version.

### Delete policy sets

<Warning>

Deleting a policy set that applies to an active run causes that run’s policy evaluation stage to error. We recommend warning other members of your organization before you delete widely used policy sets.

</Warning>

You can not restore policy sets after deletion. You must manually re-add them to HCP Terraform.

To delete a policy set:

1. Sign in to [HCP Terraform](https://app.terraform.io/) or Terraform Enterprise and navigate to the organization you want to delete a policy set in.
1. Choose **Settings** from the sidebar, then **Policies** in your organization’s settings.
2. Click the policy set you want to delete to go to its details page.
3. Click **Delete policy** and then click **Yes, delete policy set** to confirm.

The policy set no longer appears on the UI and HCP Terraform no longer applies it to any workspaces. For managed policy sets, all of the individual policies are still available in HCP Terraform. You must delete each policy individually to remove it from your organization.

### Sentinel parameters

[Sentinel parameters](/sentinel/docs/language/parameters) are a list of key-value pairs that HCP Terraform and Terraform Enterprise send to the Sentinel runtime when performing policy checks on workspaces. If the value parses as JSON, HCP Terraform and Terraform Enterprise send it to Sentinel as the corresponding type, such as string, Boolean, integer, map, or list. If the value fails JSON validation, the value is sent as a string.

You can set Sentinel parameters when you [edit a policy set](#edit-policy-sets).
