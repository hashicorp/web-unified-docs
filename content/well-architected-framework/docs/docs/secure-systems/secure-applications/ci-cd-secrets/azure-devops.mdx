---
page_title: Azure DevOps
description: Integrate Azure DevOps Pipelines with HashiCorp Vault using JWT/OIDC or managed identity authentication. Retrieve secrets with detailed audit trails.
---

# Azure DevOps

Azure DevOps Pipelines can authenticate with Vault to securely retrieve secrets for CI/CD workflows. Instead of storing credentials in Azure DevOps variable groups or pipeline variables, pipelines authenticate to Vault at runtime and retrieve secrets on demand.

## Why integrate Azure DevOps with Vault

Integrating Azure DevOps with Vault addresses the following critical security and operational challenges in pipeline automation:

**Eliminate secret sprawl across projects:** Vault centralizes secret storage so pipelines retrieve credentials on-demand from a single source, reducing the need to duplicate secrets across multiple Azure DevOps projects, variable groups, and service connections. Centralized storage simplifies rotation and reduces the risk of exposure.

**Enable automatic credential rotation:** Vault automates credential rotation and distributes updated credentials without requiring pipeline configuration changes, reducing operational overhead and maintaining security posture.

**Meet compliance and audit requirements:** Vault provides comprehensive audit logs that track every secret access with pipeline identity and timestamp, supporting regulatory compliance frameworks like SOC 2, PCI DSS, and HIPAA.

**Provide dynamic credentials:** Vault generates temporary credentials for each pipeline run that automatically expire, limiting the exposure window if credentials leak through logs, error messages, or compromised pipeline agents.

## Prerequisites

Before integrating Azure DevOps with Vault, you need the following:

- A Vault instance or HCP Vault accessible from Azure DevOps pipeline agents over the network
- Azure DevOps project with administrator access to configure pipelines and variable groups
- A Vault authentication method configured
- Vault policies that grant Azure DevOps the necessary read permissions for your secrets
- Network connectivity from Azure DevOps agents to Vault (for Microsoft-hosted agents, Vault must be publicly accessible or use Azure Private Link; for self-hosted agents, use private networking)
- Firewall rules allowing outbound HTTPS (port 443) from pipeline agents to Vault
- TLS encryption between Azure DevOps agents and Vault

## Choose an integration approach

Azure DevOps supports several approaches for integrating with Vault. Choose one of the following approaches that matches your security requirements and Azure infrastructure:

| Approach | Setup Complexity | Security Posture | Azure AD Dependency | Agent Types Supported |
|----------|-----------------|------------------|---------------------|----------------------|
| AppRole | Low | Good | None | All (Microsoft-hosted, self-hosted) |
| JWT/OIDC with Azure AD | Medium-High | Excellent | Required | All with Azure AD service connections |
| Azure Managed Identity | Medium | Excellent | Required | Self-hosted on Azure VMs only |
| Vault Agent | Medium | Excellent | Configurable | Self-hosted agents only |

- **AppRole authentication:** Install Vault CLI on pipeline agents and authenticate using the [AppRole auth method](/vault/docs/auth/approle). AppRole works reliably with Azure DevOps Pipelines, requires minimal Azure AD configuration, and supports all agent types including Microsoft-hosted and self-hosted. Store the Role ID and Secret ID in Azure DevOps variable groups with secret masking enabled. AppRole requires managing two credentials (Role ID and Secret ID) but provides straightforward setup.

- **JWT/OIDC authentication with Azure AD:** For Azure DevOps service connections with workload identity federation, authenticate to Vault through Azure AD service principals using the [JWT/OIDC auth method](/vault/docs/auth/jwt). JWT/OIDC authentication requires configuring Azure AD application registrations and service connections, but removes the need to manage Role IDs and Secret IDs in variable groups. OIDC authentication requires additional Azure AD setup and is more complex than AppRole, but provides the strongest security posture by eliminating long-lived credentials entirely. Use this approach when you need Azure AD-based identity for compliance or when integrating with other Azure AD-protected resources.

- **Azure managed identity with Vault Azure auth:** For self-hosted pipeline agents running on Azure VMs, use the [Vault Azure auth method](/vault/docs/auth/azure) to authenticate with Azure managed identities. Vault validates the Azure AD JWT token and grants access based on subscription, resource group, and VM identity. Managed identities eliminate credential management entirely but require Azure VM infrastructure. Use this approach when you run self-hosted agents on Azure infrastructure and want to leverage Azure's native identity management.

- **Vault Agent with auto-auth:** For self-hosted pipeline agents, deploy [Vault Agent](/vault/docs/agent-and-proxy/agent) as a sidecar process that handles authentication and token renewal automatically. The agent can use AppRole, Azure managed identity, or other auth methods, and exposes secrets via the agent cache. This approach reduces code complexity in pipelines and provides automatic token renewal. Use this approach when you want to simplify pipeline code and ensure tokens are always valid without manual renewal logic.

## Security best practices

When using AppRole authentication, follow these security practices:

- **Rotate Secret IDs regularly:** Generate new Secret IDs monthly or after suspected compromise using `vault write -f auth/approle/role/azure-devops/secret-id`
- **Use response wrapping:** Wrap Secret IDs when distributing them to reduce exposure: `vault write -wrap-ttl=1h -f auth/approle/role/azure-devops/secret-id`
- **Limit Secret ID usage:** Configure `secret_id_num_uses` to limit how many times a Secret ID can be used
- **Monitor authentication failures:** Set up audit logging and monitor for repeated authentication failures
- **Revoke tokens after use:** Explicitly revoke Vault tokens when pipelines complete to minimize token lifetime

## Configure Vault for Azure DevOps

Configure AppRole to issue batch tokens with appropriate TTLs:

```shell-session
vault write auth/approle/role/azure-devops \
    token_type=batch \
    secret_id_ttl=10m \
    token_ttl=1h \
    token_max_ttl=2h \
    token_policies="azure-devops-policy"
```

Configure `token_ttl` to be long enough for your pipeline to complete all tasks it needs in Vault.

For complete AppRole setup instructions, see the [AppRole auth method documentation](/vault/docs/auth/approle).

### Create Vault policies

Create policies that grant least-privilege access to secrets your pipelines need. For example, a policy that allows reading database credentials:

```hcl
# Read database credentials
path "database/creds/production" {
  capabilities = ["read"]
}

# Read static secrets
path "secret/data/azure-devops/*" {
  capabilities = ["read"]
}
```

Apply the policy:
```shell-session
vault policy write azure-devops-policy azure-devops-policy.hcl
```

For policy syntax and advanced features, see the [Vault policies documentation](/vault/docs/concepts/policies).

## Integration pattern

Azure DevOps pipelines authenticate to Vault, retrieve secrets, and set them as masked pipeline variables for use in deployment tasks:

1. **Authenticate:** Pipeline uses AppRole credentials, stored in variable groups, Azure AD OIDC tokens, or Azure managed identities to authenticate to Vault
1. **Retrieve secrets:** Pipeline calls Vault API to retrieve static secrets from KV engine or dynamic credentials from secrets engines
1. **Use secrets:** Vault secrets are set as Azure DevOps pipeline variables with secret masking enabled and used in subsequent deployment tasks

### Dynamic database credentials

The following example shows retrieving dynamic database credentials that are automatically generated and revoked:

```yaml
steps:
  - task: Bash@3
    displayName: 'Retrieve dynamic database credentials from Vault'
    inputs:
      targetType: 'inline'
      script: |
        # Authenticate to Vault with AppRole
        export VAULT_ADDR="https://vault.example.com:8200"
        export VAULT_TOKEN=$(vault write -field=token auth/approle/login \
          role_id=$(VAULT_ROLE_ID) \
          secret_id=$(VAULT_SECRET_ID))

        # Generate dynamic credentials (automatically revoked after lease expires)
        CREDS=$(vault read -format=json database/creds/production)
        DB_USERNAME=$(echo $CREDS | jq -r '.data.username')
        DB_PASSWORD=$(echo $CREDS | jq -r '.data.password')

        # Set as masked pipeline variables
        echo "##vso[task.setvariable variable=DB_USERNAME;issecret=true]$DB_USERNAME"
        echo "##vso[task.setvariable variable=DB_PASSWORD;issecret=true]$DB_PASSWORD"

        # Revoke token immediately after retrieving secrets
        vault token revoke -self
```

Dynamic credentials are automatically revoked when the Vault lease expires, limiting the exposure window. For database secrets engine configuration, see the [database secrets engine documentation](/vault/docs/secrets/databases).

### Azure service principal credentials

For Azure deployments, generate short-lived service principals dynamically. After authenticating to Vault (shown above), retrieve Azure credentials:

```yaml
# Generate dynamic Azure service principal
AZURE_CREDS=$(vault read -format=json azure/creds/deploy-role)
AZURE_CLIENT_ID=$(echo $AZURE_CREDS | jq -r '.data.client_id')
AZURE_CLIENT_SECRET=$(echo $AZURE_CREDS | jq -r '.data.client_secret')

# Set for Azure CLI tasks
echo "##vso[task.setvariable variable=AZURE_CLIENT_ID;issecret=true]$AZURE_CLIENT_ID"
echo "##vso[task.setvariable variable=AZURE_CLIENT_SECRET;issecret=true]$AZURE_CLIENT_SECRET"
```

The service principal is automatically deleted when the lease expires. For Azure secrets engine configuration, see the [Azure secrets engine documentation](/vault/docs/secrets/azure).

## Enable audit logging

Track all secret access from Azure DevOps pipelines by enabling Vault audit logging:

```shell-session
# Enable file audit device
vault audit enable file file_path=/var/log/vault/audit.log
```

Each pipeline authentication and secret retrieval is logged with:
- Timestamp
- Pipeline identity (AppRole role name)
- Secret path accessed
- IP address of the agent

Review audit logs regularly for:
- Unexpected authentication attempts
- Access to sensitive secret paths
- Failed authentication from unknown IPs

For complete implementation guidance, including Vault configuration, authentication method setup, and verification steps, review the following HashiCorp resources.

## HashiCorp resources

Vault authentication for CI/CD:

- Read the [Vault authentication methods documentation](/vault/docs/auth) for an overview of available auth methods
- Learn about the [AppRole auth method](/vault/docs/auth/approle) for machine-to-machine authentication in pipelines
- Learn about [JWT/OIDC auth method](/vault/docs/auth/jwt) for token-based pipeline authentication
- Learn about the [Azure auth method](/vault/docs/auth/azure) for managed identity authentication
- Configure the [Azure AD OIDC provider](/vault/docs/auth/jwt/oidc-providers/azuread) for Azure-specific OIDC configuration with workload identity federation
- Review the [Azure AD OIDC setup guide](/vault/docs/auth/jwt/oidc-providers/azuread#optional-azure-specific-configuration) for handling users with 200+ group memberships

Azure DevOps and Vault integration:

- Read [Integrating Azure DevOps Pipelines with HashiCorp Vault](https://www.hashicorp.com/en/blog/integrating-azure-devops-pipelines-with-hashicorp-vault) for practical integration guidance
- Complete the [Integrate Terraform with Vault](/validated-patterns/terraform-integrate-vault) tutorial for end-to-end integration patterns
- Review [AppRole Pull Authentication](/vault/tutorials/auth-methods/approle) tutorial for complete AppRole setup
- Learn about [AppRole best practices](/vault/tutorials/auth-methods/approle-best-practices) for production deployments

Batch tokens for CI/CD:

- Understand [token types](/vault/docs/concepts/tokens#token-types) and why batch tokens are recommended for pipelines
- Learn about [token lifecycle](/vault/docs/concepts/tokens) including TTLs and renewal

Vault secrets and dynamic credentials:

- Understand [dynamic and static secrets](/vault/tutorials/get-started/understand-static-dynamic-secrets) to choose the right approach for your pipelines
- Read the [KV secrets engine documentation](/vault/docs/secrets/kv) for static secret storage
- Learn about [Azure secrets engine](/vault/docs/secrets/azure) for dynamic Azure service principals
- Learn about [AWS secrets engine](/vault/docs/secrets/aws) for dynamic cloud credentials
- Explore [database secrets engine](/vault/docs/secrets/databases) for dynamic database credentials
- Configure [PostgreSQL dynamic credentials](/vault/docs/secrets/databases/postgresql) for Azure Database for PostgreSQL
- Configure [MySQL dynamic credentials](/vault/docs/secrets/databases/mysql) for Azure Database for MySQL
- Configure [MSSQL dynamic credentials](/vault/docs/secrets/databases/mssql) for Azure SQL Database

### External resources

- Read the [Azure DevOps workload identity federation documentation](https://learn.microsoft.com/en-us/azure/devops/pipelines/library/connect-to-azure?view=azure-devops#create-an-azure-resource-manager-service-connection-that-uses-workload-identity-federation) for OIDC service connection setup
- Review [Azure Pipelines YAML schema reference](https://learn.microsoft.com/en-us/azure/devops/pipelines/yaml-schema/) for pipeline configuration syntax
- Learn about [Azure DevOps variable groups](https://learn.microsoft.com/en-us/azure/devops/pipelines/library/variable-groups) for secrets management

## Next steps

In this section of [managing CI/CD secrets](/well-architected-framework/secure-systems/secure-applications/ci-cd-secrets), you learned about Azure DevOps and Vault integration. Azure DevOps and Vault integration is part of the [Secure systems pillar](/well-architected-framework/secure-systems).

- Review the [CI/CD secrets overview](/well-architected-framework/secure-systems/secure-applications/ci-cd-secrets) for architectural guidance across platforms
- Compare [dynamic and static secrets in CI/CD](/well-architected-framework/secure-systems/secure-applications/ci-cd-secrets/dynamic-and-static-secrets) to choose the right secrets strategy
