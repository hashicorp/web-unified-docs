---
page_title: TeamCity
description: Integrate TeamCity with HashiCorp Vault using AppRole or LDAP authentication. Retrieve static and dynamic secrets securely with audit logs and automatic rotation.
---

# TeamCity

[TeamCity](https://www.jetbrains.com/teamcity/) supports native parameters and tokens to secure CI/CD pipelines, and also features the ability to add extra security through external secret managers like Vault. You can use the TeamCity Vault plugin to store sensitive values in Vault KV secrets engines.

## Why integrate TeamCity with Vault

Integrating TeamCity with Vault addresses the following critical security and operational challenges in build automation:

**Enhance native secret management:** Vault provides enterprise-grade secret management with automated rotation, dynamic secret generation, and centralized policy management that can span multiple TeamCity instances.

**Eliminate secret sprawl across projects:** Vault centralizes secret storage so builds retrieve credentials on-demand from a single source, reducing the need to duplicate secrets across multiple TeamCity projects and build configurations. Centralized storage simplifies rotation and reduces the risk of exposure.

**Meet compliance and audit requirements:** Vault provides comprehensive audit logs that track every secret access with build identity and timestamp, supporting compliance with security standards and regulatory frameworks.

**Enable dynamic credential support:** Vault generates temporary credentials for each build that automatically expire, minimizing exposure windows compared to long-lived static credentials.

## Prerequisites

Before integrating TeamCity with Vault, you need the following:

- A Vault instance or HCP Vault accessible from TeamCity build agents over the network
- TeamCity installation with administrator access to configure projects and build configurations
- [HashiCorp Vault plugin for TeamCity](https://plugins.jetbrains.com/plugin/10011-hashicorp-vault-support) installed
- A Vault authentication method configured (AppRole or LDAP)
- Vault policies that grant TeamCity the necessary read permissions for your secrets
- We recommend TLS encryption between TeamCity agents and Vault

## Choose an integration approach

TeamCity integrates with Vault using the native HashiCorp Vault plugin, which supports two authentication methods. Choose the approach that matches your infrastructure and security requirements:

| Approach | Setup Complexity | LDAP Dependency | Credential Management | Best For |
|----------|-----------------|-----------------|----------------------|----------|
| AppRole | Low | None | Role ID + Secret ID in TeamCity credentials | Automated pipelines and machine authentication |
| LDAP | Medium | Required | LDAP user accounts | Teams with existing LDAP infrastructure |

- **AppRole authentication:** We recommend this approach for automated pipelines. AppRole provides programmatic, machine-to-machine authentication with fine-grained access control using role IDs and secret IDs. Store the role ID and secret ID in TeamCity credentials with secure storage. AppRole requires managing two credentials but provides better security through credential separation and works without LDAP infrastructure. Use this approach for most TeamCity integrations.

- **LDAP authentication:** Leverages existing LDAP infrastructure and user directories for authentication. This approach simplifies credential management by using your organization's existing LDAP credentials, but requires maintaining LDAP user accounts for TeamCity service identities. LDAP authentication requires an operational LDAP server and proper network connectivity. Use this approach when you have established LDAP infrastructure and want to centralize identity management.

## Integration pattern

TeamCity retrieves secrets from Vault using the HashiCorp Vault plugin with Kotlin DSL configuration:

1. **Configure connection:** Define a `hashiCorpVaultConnection` in TeamCity project settings, specifying Vault URL and authentication method (AppRole or LDAP)
2. **Define parameters:** Create `hashiCorpVaultParameter` configurations that reference Vault secret paths using the format `secret/path!/field`
3. **Retrieve at build time:** TeamCity automatically authenticates to Vault and retrieves secrets when builds start
4. **Use in builds:** Secrets are available as environment variables, automatically masked in build logs

The following example shows a minimal AppRole authentication pattern for TeamCity projects:

```kotlin
project {
    features {
        hashiCorpVaultConnection {
            id = "PROJECT_EXT_VAULT"
            name = "HashiCorp Vault"
            url = "https://vault.example.com:8200"
            vaultNamespace = ""
            authMethod = appRole {
                roleId = "credentialsJSON:vault-role-id"
                secretId = "credentialsJSON:vault-secret-id"
            }
        }
    }

    params {
        hashiCorpVaultParameter {
            name = "env.DB_PASSWORD"
            query = "secret/data/database/production!/password"
            vaultId = "PROJECT_EXT_VAULT"
        }
    }
}
```

The configuration defines a Vault connection using AppRole authentication with role ID and secret ID stored in TeamCity credentials. It then defines a parameter that retrieves a database password from Vault's KV secrets engine and makes it available as the `DB_PASSWORD` environment variable. Build steps can reference the secret using `%env.DB_PASSWORD%`, and TeamCity automatically masks the value in build logs.

For complete implementation guidance including Kotlin DSL examples, UI configuration, and dynamic secrets setup, review the HashiCorp resources below.

## HashiCorp resources

Vault authentication for CI/CD:

- Read the [Vault authentication methods documentation](/vault/docs/auth) for an overview of available auth methods
- Learn about the [AppRole auth method](/vault/docs/auth/approle) for machine-to-machine authentication in pipelines
- Read the [LDAP auth method documentation](/vault/docs/auth/ldap) for directory-based authentication

Vault secrets and dynamic credentials:

- Understand [dynamic and static secrets](/vault/tutorials/get-started/understand-static-dynamic-secrets) to choose the right approach for your pipelines
- Read the [KV secrets engine documentation](/vault/docs/secrets/kv) for static secret storage
- Learn about [database secrets engine](/vault/docs/secrets/databases) for dynamic database credentials

### External resources

TeamCity configuration resources:

- Read the [TeamCity Kotlin DSL documentation](https://www.jetbrains.com/help/teamcity/kotlin-dsl.html) for project configuration syntax and patterns
- Learn about [TeamCity typed parameters](https://www.jetbrains.com/help/teamcity/typed-parameters.html) for secret parameter handling
- Explore [TeamCity project configuration examples](https://github.com/JetBrains/teamcity-documentation/tree/master/topics) for configuration patterns

Videos and demonstrations:

- Watch [New in TeamCity: Remote Parameters and Updated HashiCorp Vault Plugin](https://www.youtube.com/watch?v=cRNl2dTulTA) for plugin feature demonstrations
- Watch [TeamCity Configuration as Code with Kotlin DSL](https://www.youtube.com/watch?v=9AEgZrjQx1M) for Kotlin DSL fundamentals
- Watch [Secure CI/CD Pipelines with HashiCorp Vault](https://www.youtube.com/watch?v=lsWOx9bzAwY) for security patterns applicable to TeamCity

Read the [TeamCity HashiCorp Vault integration guide](https://www.jetbrains.com/help/teamcity/hashicorp-vault.html) for detailed plugin configuration and troubleshooting steps.

Install the [TeamCity plugin for HashiCorp Vault](https://plugins.jetbrains.com/plugin/10011-hashicorp-vault-support) from the JetBrains Plugin Marketplace.

Review the [TeamCity Vault plugin source code](https://github.com/JetBrains/teamcity-hashicorp-vault-plugin) for implementation details and contribution opportunities.

Explore [TeamCity plugin examples](https://github.com/JetBrains/teamcity-hashicorp-vault-plugin/tree/main/common/src/test/resources) for working Vault integration configurations.

Read [Securing TeamCity CI/CD Pipelines with HashiCorp Vault](https://www.hashicorp.com/blog/securing-ci-cd-pipelines-with-hashicorp-vault) for HashiCorp's best practices and patterns.

Learn about [TeamCity and Vault AppRole authentication](https://blog.jetbrains.com/teamcity/2020/10/teamcity-hashicorp-vault-integration/) from the JetBrains TeamCity blog.

Explore [TeamCity community discussions on Vault integration](https://teamcity-support.jetbrains.com/hc/en-us/community/topics/200366979-TeamCity-Discussions) for troubleshooting and community solutions.

## Next steps

In this section of [managing CI/CD secrets](/well-architected-framework/secure-systems/secure-applications/ci-cd-secrets), you learned about TeamCity and Vault integration. TeamCity and Vault integration is part of the [Secure systems pillar](/well-architected-framework/secure-systems).

- Review the [CI/CD secrets overview](/well-architected-framework/secure-systems/secure-applications/ci-cd-secrets) for architectural guidance across platforms
- Compare [dynamic and static secrets in CI/CD](/well-architected-framework/secure-systems/secure-applications/ci-cd-secrets/dynamic-and-static-secrets) to choose the right secrets strategy