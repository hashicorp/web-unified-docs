---
page_title: Tag cloud resources
description: Implement cloud resource tagging best practices with Terraform for AWS, Azure, and GCP. Learn to automate tags, enforce policies, and optimize cost allocation using infrastructure as code.
---

# Tag cloud resources

Managing thousands of cloud resources across regions, environments, and teams is complex. Tags are key-value pairs that help you manage, identify, organize, locate, and filter resources. It is important to have a clear, well-defined cloud resource tagging strategy. You can also use tags to track cost allocation and usage, and automate resource management tasks.

[AWS](https://docs.aws.amazon.com/whitepapers/latest/tagging-best-practices/tagging-best-practices.html), [Azure](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-tagging), and [IBM](https://cloud.ibm.com/docs/framework-financial-services?topic=framework-financial-services-shared-tagging-resources) maintain best practices and strategies for tagging your cloud resources. Follow these best practices when creating your tagging strategy. You can apply these concepts to other infrastructure providers.

You can implement your tagging strategy using infrastructure as code (IaC) and enforce compliance with policy as code to prevent deploying resources that don't meet your tagging requirements.

When you implement a tagging strategy, you gain the following benefits:

- **Easier resource tracking:** Find resources by environment, owner, or other custom tag. For example, quickly find all servers in the 'dev' environment.
- **Granular cost allocation:** Track costs by project, team, or application.
- **Tag-based resource automation:** Automate resource management tasks based on tags, such as starting or stopping instances.
- **Default resource compliance:** Enforce tagging policies to ensure all resources are tagged correctly.

## Deploy tags using infrastructure as code

Consistent implementation of your tagging strategy helps you track infrastructure costs, manage resources, and ensure compliance. When you use an inconsistent tagging strategy, such as manual tagging, you may end up with resources with incorrect or missing tags.

When you manage your infrastructure with Terraform, you can define tags within your modules. Terraform will automatically apply these tags to all resources it creates.

The following is an example of tags defined in a Terraform module:

```hcl
resource "aws_instance" "web_server" {
  ami           = "ami-0c55b159cbfafe1f0"
  instance_type = "t3.micro"
  
  tags = {
    Name        = "web-server-prod"
    Environment = "production"
    Owner       = "platform-team"
    CostCenter  = "engineering"
    Application = "website"
  }
}

```

The AWS and GCP Terraform providers let you add default tags to all resources they create, making it easier to implement a consistent tagging strategy across all the resources you manage with Terraform. You can then override these default tags on a per-resource basis. Default tags ensure that all resources have the minimum required tags.

The following is an example of default tags:

```hcl

provider "aws" {
  profile = "default"
  region  = "us-east-2"

  default_tags {
    tags = {
      Environment     = "Test"
      Service         = "Payment API"
    }
  }
}
```

HashiCorp resources:

- AWS provider [resource tagging](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/guides/resource-tagging)
- [AWS default tags](https://developer.hashicorp.com/terraform/tutorials/aws/aws-default-tags)
- [GCP default tags](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference#default_labels-1)
- Learn how to [configure default tags for AWS resources](/terraform/tutorials/aws/aws-default-tags)

## Enforce tagging strategy

Once you define and implement your tagging strategy using infrastructure as code, you can enforce it to prevent the deployment of resources that do not comply. 

### Use the Terraform validation block

You can use the [Terraform validation block](/terraform/language/values/variables#validation) to enforce tagging policies. The validation block allows you to define custom validation rules for input variables. You can use this feature to ensure that the resources you tag follow your tagging strategy.

The following is an example of a Terraform validation block that ensures the `environment` tag is set to either `dev`, `staging`, or `prod`:

```hcl
variable "environment" {
  type        = string
  description = "Environment name for resource tagging"
  
  validation {
    condition     = contains(["dev", "staging", "prod"], var.environment)
    error_message = "Environment must be one of: dev, staging, prod."
  }
}
```

If you create a resource with an invalid `environment` tag, Terraform returns an error and prevents the deployment.

The following tag passes the validation:

```hcl
environment = "prod"
```

The following tag fails the validation due to not meeting the condition of being `dev`, `staging`, or `prod`:

```hcl
environment = "testing"
```

### Use policy as code

For more advanced enforcement of your tagging strategy, you can use policy as code tools such as HashiCorp Sentinel or the Open Policy Agent (OPA) to create policies that enforce tagging rules. You can integrate these policies into your CI/CD pipelines to ensure that all resources comply with your tagging strategy before deployment.

The following is an example of a [`Pass` or `Fail` Sentinel policy](/terraform/tutorials/policy/sentinel-policy#review-your-policy) that ensures that all AWS EC2 instances have a `Name` tag:

```script
import "tfplan/v2" as tfplan

# Get all AWS instances from all modules
ec2_instances = filter tfplan.resource_changes as _, rc {
    rc.type is "aws_instance" and
        (rc.change.actions contains "create" or rc.change.actions is ["update"])
}

# Mandatory Instance Tags
mandatory_tags = [
    "Name",
]

# Rule to enforce "Name" tag on all instances
mandatory_instance_tags = rule {
    all ec2_instances as _, instance {
        all mandatory_tags as mt {
            instance.change.after.tags contains mt
        }
    }
}

main = rule {
    mandatory_instance_tags else true
}
```

You can write similar policies with OPA and HCP Terraform. Refer to the following external resources for more information.

HashiCorp resources:

- Read about the [Terraform validation block](/terraform/language/values/variables#validation)
- Write a [Sentinel policy for a Terraform deployment](/terraform/tutorials/policy/sentinel-policy) to ensure that the EC2 instance has a `Name` tag.
- Learn how to [define Open Policy Agent policies for HCP Terraform](/terraform/enterprise/policy-enforcement/define-policies/opa)
- [HCP Terraform policy enforcement overview](/terraform/enterprise/policy-enforcement)
- [Get started with Sentinel](/sentinel/tutorials/get-started)

External resources:
- Use [OPA to write policies](https://www.openpolicyagent.org/docs/terraform) ensuring all resources have tags before you create them.

## Next steps

In this section of Manage cost, you learned how to tag resources using infrastructure as code and enforce tagging policies. Tag resources is part of the Optimize systems pillar.

To learn more about how to manage our resources, visit the following resources:
- [Implement data management policies](/well-architected-framework/optimize-systems/lifecycle-management/data-management)
- [Decommission resources](/well-architected-framework/optimize-systems/lifecycle-management/decommission-infrastructure)