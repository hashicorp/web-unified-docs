---
page_title: Detect cloud spending anomalies before they become costly
description: Identify unusual cloud spending patterns with automated anomaly detection. Use Terraform and machine learning to catch cost issues before they spike.
---

# Detect cloud spending anomalies with machine learning

Anomaly detection catches cost issues that [cloud budgets](/well-architected-framework/optimize-systems/manage-cost/create-cloud-budgets) miss. If your monthly spending doubles from $2,000 to $4,000 but remains under your $5,000 budget, a budget alert would not trigger. Terraform lets you configure AWS, Azure, and Google Cloud anomaly detection to automatically flag unusual spending increases using machine learning.

## Why detect spending anomalies

Anomaly detection addresses the following challenges that static budgets cannot solve:

- **Identify spending patterns within budget limits:** Budgets only alert when you exceed thresholds, but anomaly detection identifies unusual spending patterns even when costs remain within limits.
- **Catch rapid cost escalation:** Misconfigured autoscaling, forgotten test resources, or unauthorized usage can escalate costs quickly before manual reviews detect them.
- **Learn environment-specific baselines:** Each environment has different normal spending patterns. Anomaly detection learns these baselines automatically rather than requiring manual threshold configuration.
- **Detect problems early:** Machine learning-based detection identifies cost anomalies within hours rather than waiting for monthly reviews or budget threshold breaches.

## How anomaly detection works

Cloud providers use machine learning to establish spending baselines and alert you when costs deviate significantly:

- **AWS Cost Anomaly Detection:** Monitors spending by service, account, or cost category. Learns patterns over 10-14 days and sends alerts when spending deviates from the baseline.
- **Azure Cost Management:** Provides anomaly detection that identifies unexpected charges and spending pattern changes at the subscription level.
- **Google Cloud:** Offers anomaly detection through BigQuery cost analysis, though native alerting differs from AWS and Azure.

Using Terraform to configure anomaly detection ensures consistent monitoring across environments and lets you version control your cost governance policies.

## Configure anomaly detection with Terraform and AWS

The following examples show anomaly detection configurations that alert when unusual spending patterns exceed a threshold:

<Tabs>
<Tab heading="AWS" group="cloud-provider">

```hcl
resource "aws_ce_anomaly_monitor" "service_monitor" {
  name              = "service-anomaly-monitor"
  monitor_type      = "DIMENSIONAL"
  monitor_dimension = "SERVICE"
}

resource "aws_ce_anomaly_subscription" "alerts" {
  name      = "anomaly-alerts"
  frequency = "DAILY"

  monitor_arn_list = [
    aws_ce_anomaly_monitor.service_monitor.arn
  ]

  subscriber {
    type    = "EMAIL"
    address = "platform-team@example.com"
  }

  threshold_expression {
    dimension {
      key           = "ANOMALY_TOTAL_IMPACT_ABSOLUTE"
      match_options = ["GREATER_THAN_OR_EQUAL"]
      values        = ["100"]
    }
  }
}
```

The monitor tracks spending patterns across all AWS services. The subscription sends daily alerts when anomalies exceed $100 impact.

</Tab>
<Tab heading="Azure" group="cloud-provider">

```hcl
resource "azurerm_cost_anomaly_alert" "alerts" {
  name            = "cost-anomaly-alert"
  display_name    = "Cost Anomaly Alert"
  subscription_id = data.azurerm_subscription.current.id
  email_subject   = "Azure Cost Anomaly Detected"
  email_addresses = ["platform-team@example.com"]
}
```

Azure anomaly alerts notify you when the service detects unusual spending patterns at the subscription level.

</Tab>
<Tab heading="GCP" group="cloud-provider">

Google Cloud does not currently have a dedicated Terraform resource for cost anomaly detection. GCP provides anomaly detection through Cost Management in the Cloud Console, but Terraform support is not yet available.

To monitor for cost anomalies in GCP, you can use the following approaches:

- Configure [cloud budgets](/well-architected-framework/optimize-systems/manage-cost/create-cloud-budgets) with Terraform and monitor for unexpected threshold breaches
- Use BigQuery to analyze billing exports and identify spending patterns
- Set up Cloud Monitoring alerts based on billing metrics

Track the [terraform-provider-google feature request](https://github.com/hashicorp/terraform-provider-google/issues/19864) for updates on native anomaly detection support.

</Tab>
</Tabs>

Refer to the Terraform registry documentation for complete configuration options.

## Respond to anomaly alerts

When you receive an anomaly alert, complete the following steps:

1. **Identify the cause:** Use your cloud provider's cost explorer to examine which resources or services show unusual spending.
1. **Determine if legitimate:** Distinguish between expected scaling, forgotten resources, misconfigurations, or potential security incidents.
1. **Take action:** [Decommission unused resources](/well-architected-framework/optimize-systems/lifecycle-management/decommission-infrastructure), fix misconfigurations, or document legitimate growth. For security incidents, terminate unauthorized resources and rotate credentials immediately.

HashiCorp resources:

- New to Terraform? Start with [What is Terraform?](/terraform/intro) to understand infrastructure as code fundamentals
- Set threshold-based spending limits with [cloud budgets](/well-architected-framework/optimize-systems/manage-cost/create-cloud-budgets)
- Identify which teams trigger anomalies using a [cloud resource tagging strategy](/well-architected-framework/optimize-systems/lifecycle-management/tag-cloud-resources)
- Standardize anomaly detection across environments with [reusable infrastructure modules](/well-architected-framework/define-and-automate-processes/define/modules)
- Automate anomaly detection deployment through [CI/CD pipelines](/well-architected-framework/define-and-automate-processes/automate/cicd)
- Explore [aws_ce_anomaly_monitor](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ce_anomaly_monitor) for monitor configuration options
- Explore [aws_ce_anomaly_subscription](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ce_anomaly_subscription) for alert threshold and notification settings
- Explore [azurerm_cost_anomaly_alert](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cost_anomaly_alert) for Azure subscription-level alerts

External resources:

- [AWS Cost Anomaly Detection documentation](https://docs.aws.amazon.com/cost-management/latest/userguide/manage-ad.html) covers monitor types and machine learning baselines
- [Azure cost analysis guide](https://learn.microsoft.com/en-us/azure/cost-management-billing/understand/analyze-unexpected-charges) walks through investigating unexpected charges
- [Google Cloud anomaly detection overview](https://cloud.google.com/bigquery/docs/anomaly-detection-overview) explains BigQuery-based cost analysis

## Next steps

In this section of Manage cost, you learned how to detect cloud spending anomalies with Terraform and machine learning to catch cost issues that fall within budget limits. Anomaly detection is part of the [Optimize systems pillar](/well-architected-framework/optimize-systems).

Visit the following documents to continue building your cost management strategy:

- Set threshold-based spending limits with [cloud budgets](/well-architected-framework/optimize-systems/manage-cost/create-cloud-budgets)
- Reduce pipeline and test environment costs with [automation cost optimization](/well-architected-framework/optimize-systems/manage-cost/optimize-automation-costs)
- Remove forgotten resources revealed by anomalies by [decommissioning unused infrastructure](/well-architected-framework/optimize-systems/lifecycle-management/decommission-infrastructure)
