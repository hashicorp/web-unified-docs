---
page_title: How to catch cloud spending anomalies before they spike
description: Catch unusual cloud spending patterns before they become costly. Learn how to implement anomaly detection with alerts using infrastructure as code.
---

# How to catch cloud spending anomalies before they spike

Monitoring for cloud spending anomalies help you identify cost issues that budgets miss. After [creating cloud budgets](/well-architected-framework/optimize-systems/manage-cost/create-cloud-budgets), you can implement anomaly detection to catch unusual spending patterns that fall within budget limits but indicate problems. For example, if your monthly cloud spending suddenly doubles from $2,000 to $4,000 but remains under your $5,000 budget, a budget alert would not trigger. However, anomaly detection would flag this unusual increase for investigation.

## Why detect spending anomalies

Anomaly detection addresses the following challenges that static budgets cannot solve:

**Pattern-based cost issues:** Budgets only alert when you exceed thresholds, but anomaly detection identifies unusual spending patterns even when costs remain within budget limits.

**Rapid cost escalation:** Misconfigured autoscaling, forgotten test resources, or unauthorized usage can escalate costs quickly before manual reviews detect them.

**Environment-specific baselines:** Each environment has different normal spending patterns, and anomaly detection learns these baselines automatically rather than requiring manual threshold configuration for each scenario.

**Early problem detection:** Machine learning-based detection identifies cost anomalies within hours rather than waiting for monthly reviews or budget threshold breaches.

Most cloud providers offer machine learning-based anomaly detection that learns your normal usage patterns and alerts you when spending deviates from the baseline. You can configure anomaly detection with AWS Cost Anomaly Detection and Azure Cost Management using Terraform.

## Set up anomaly detection in AWS

The following example shows a complete Terraform configuration that sets up cost anomaly detection with email alerts in AWS. The configuration includes provider setup, variables for customization, and outputs for integration with other systems.

```hcl
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = var.aws_region
}

variable "aws_region" {
  description = "AWS region for anomaly detection"
  type        = string
  default     = "us-east-1"
}

variable "alert_email" {
  description = "Email address to receive anomaly alerts"
  type        = string
}

variable "anomaly_threshold" {
  description = "Minimum dollar amount to trigger anomaly alert"
  type        = string
  default     = "100"
}

variable "environment" {
  description = "Environment name (e.g., production, staging)"
  type        = string
  default     = "production"
}

resource "aws_ce_anomaly_monitor" "service_monitor" {
  name              = "service-anomaly-monitor-${var.environment}"
  monitor_type      = "DIMENSIONAL"
  monitor_dimension = "SERVICE"
}

resource "aws_ce_anomaly_subscription" "daily_alerts" {
  name      = "daily-anomaly-subscription-${var.environment}"
  frequency = "DAILY"

  monitor_arn_list = [
    aws_ce_anomaly_monitor.service_monitor.arn
  ]

  subscriber {
    type    = "EMAIL"
    address = var.alert_email
  }

  threshold_expression {
    dimension {
      key           = "ANOMALY_TOTAL_IMPACT_ABSOLUTE"
      match_options = ["GREATER_THAN_OR_EQUAL"]
      values        = [var.anomaly_threshold]
    }
  }

  tags = {
    Environment = var.environment
    ManagedBy   = "terraform"
  }
}

output "monitor_arn" {
  description = "ARN of the anomaly monitor"
  value       = aws_ce_anomaly_monitor.service_monitor.arn
}

output "subscription_arn" {
  description = "ARN of the anomaly subscription"
  value       = aws_ce_anomaly_subscription.daily_alerts.arn
}
```

The configuration includes the following key components:

- **aws_ce_anomaly_monitor:** Tracks spending patterns across all AWS services including EC2, S3, and Lambda using machine learning to establish baselines.
- **monitor_dimension = "SERVICE":** Monitors costs at the service level to detect which AWS service shows unusual spending.
- **frequency = "DAILY":** Sends a daily summary of detected anomalies rather than immediate alerts for each anomaly.
- **threshold_expression:** Filters alerts to only notify when the anomaly's financial impact meets or exceeds the threshold amount.
- **Variables:** Allow you to customize email address, threshold, and environment without modifying code.
- **Environment-specific naming:** Resource names include environment variable for easier management across multiple environments.

The monitor uses AWS machine learning to analyze spending patterns over time. When spending deviates significantly from the learned baseline, AWS generates an anomaly with a dollar impact value. The subscription only sends alerts when the impact exceeds your threshold.

## Deploy and verify anomaly detection

After creating your Terraform configuration, deploy anomaly detection with the following steps:

1. **Initialize Terraform** to download the required providers:
   ```bash
   terraform init
   ```

1. **Preview the changes** to verify the configuration:
   ```bash
   terraform plan -var="alert_email=your-email@example.com"
   ```

1. **Apply the configuration** to create the anomaly monitor and subscription:
   ```bash
   terraform apply -var="alert_email=your-email@example.com"
   ```

1. **Verify the anomaly monitor in AWS Console:**
   - Navigate to AWS Cost Management â†’ Cost Anomaly Detection
   - Locate your monitor (e.g., "service-anomaly-monitor-production")
   - Confirm the monitor is active and tracking services

1. **Confirm email alerts:**
   - Check your email for an AWS Notifications verification message
   - Click the verification link to enable anomaly alerts
   - Note: AWS needs 10-14 days of spending history to establish accurate baselines

The anomaly detection service begins learning your spending patterns immediately. However, accurate anomaly detection requires historical data to establish baselines. Expect the service to improve accuracy over the first two weeks as it collects more data.

## Respond to anomaly alerts

When you receive an anomaly alert, follow this workflow to investigate and resolve the issue:

1. **Review the anomaly details:**
   - Check the email alert for the affected service and dollar impact
   - Note the detection date and spending period
   - Identify whether the anomaly is a spike or sustained increase

1. **Investigate the root cause:**
   - Navigate to AWS Cost Anomaly Detection console
   - Click on the anomaly to view detailed breakdown
   - Use Cost Explorer to examine resource-level details
   - Check for: new resource launches, configuration changes, usage pattern shifts, or data transfer increases

1. **Determine if the anomaly is legitimate or problematic:**
   - **Expected scaling:** Planned capacity increases or traffic growth
   - **Forgotten resources:** Test environments or development instances left running
   - **Misconfiguration:** Autoscaling policies triggering unnecessarily or incorrect instance types
   - **Security incident:** Unauthorized resource creation or compromised credentials
   - **Service outage recovery:** Catch-up processing after downtime

1. **Take corrective action:**
   - **Legitimate growth:** Document the change and adjust your [budget thresholds](/well-architected-framework/optimize-systems/manage-cost/create-cloud-budgets) if needed
   - **Forgotten resources:** [Decommission unused infrastructure](/well-architected-framework/optimize-systems/lifecycle-management/decommission-infrastructure) following proper procedures
   - **Misconfiguration:** Fix autoscaling policies, right-size instances, or optimize configurations
   - **Security incident:** Terminate unauthorized resources and rotate credentials immediately

1. **Update your cost management strategy:**
   - Adjust anomaly thresholds if alerts are too sensitive
   - Implement [resource tagging](/well-architected-framework/optimize-systems/lifecycle-management/tag-cloud-resources) for better cost attribution
   - Set up additional monitors for specific services showing frequent anomalies
   - Create runbooks for common anomaly scenarios

## Multi-cloud anomaly detection

For Azure environments, you can use the `azurerm_cost_anomaly_alert` resource to configure anomaly detection. Azure provides similar machine learning capabilities to identify unusual spending patterns.

For Google Cloud Platform, anomaly detection capabilities are available through BigQuery for detailed cost analysis, though native anomaly alerting features differ from AWS and Azure.

HashiCorp resources:

- Terraform resource: [aws_ce_anomaly_monitor](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ce_anomaly_monitor)
- Terraform resource: [aws_ce_anomaly_subscription](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ce_anomaly_subscription)
- Terraform resource: [azurerm_cost_anomaly_alert](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cost_anomaly_alert)
- Start learning Terraform with the [Get started tutorials](/terraform/tutorials)

External resources:

- [AWS getting started with AWS Cost Anomaly Detection](https://docs.aws.amazon.com/cost-anomaly/latest/userguide/what-is-cost-anomaly.html)
- [Azure identify anomalies and unexpected changes in cost](https://learn.microsoft.com/en-us/azure/cost-management-billing/understand/analyze-unexpected-charges)
- [Google cloud anomaly detection overview](https://cloud.google.com/bigquery/docs/anomaly-detection-overview)

## Next steps

In this section of Manage cost, you learned about detecting cloud spending anomalies using Terraform. You created an anomaly detection monitor, deployed it with Terraform, and learned how to investigate and respond to anomaly alerts. Detect cloud spending anomalies is part of the [Optimize systems](/well-architected-framework/optimize-systems).

To build a complete cost management strategy, implement cost controls in the following order:

1. **Create budgets first:** Establish [cloud budgets](/well-architected-framework/optimize-systems/manage-cost/create-cloud-budgets) to set spending limits and receive threshold alerts before implementing anomaly detection.

1. **Implement tagging:** Maintain a consistent [cloud resource tagging strategy](/well-architected-framework/optimize-systems/lifecycle-management/tag-cloud-resources) to attribute costs accurately and identify which teams or projects trigger anomalies.

1. **Optimize resource lifecycle:** Follow [infrastructure decommissioning best practices](/well-architected-framework/optimize-systems/lifecycle-management/decommission-infrastructure) to eliminate waste identified through anomaly detection.

1. **Modularize for scale:** When managing anomaly detection across multiple accounts or environments, [create reusable infrastructure modules](/well-architected-framework/define-and-automate-processes/define/modules) to standardize configurations.

Additional cost optimization resources:

- [Reduce costs with Terraform Cloud ephemeral workspaces](https://www.youtube.com/watch?v=-woCmG8yGdA)