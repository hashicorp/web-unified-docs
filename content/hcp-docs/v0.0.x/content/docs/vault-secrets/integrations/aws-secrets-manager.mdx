---
page_title: Integrate with AWS Secrets Manager
sidebar_title: AWS Secrets Manager
description: |-
  Describes how to set up automated synchronization of application secrets to AWS Secrets Manager.
---

# Integrate with AWS Secrets Manager

HCP Vault Secrets allows users to automatically synchronize application secrets to AWS Secrets Manager.
This guide walks you through the configuration process.

## Prerequisites:

* Ability to create AWS IAM roles
* Ability to create AWS IAM policies
* An Admin role in an HCP Project
* An HCP Vault Secrets application and secret(s)

## Configuration

1. Navigate to the HCP Vault Secrets app you would like to integrate with your
   AWS account. From the sidebar, select **Integrations** then click on the **AWS Secrets Manager** card to initiate the setup.

   ![Integration - AWS Sync](/img/docs/vault-secrets/integration-select-cards.png)

   If this is your first time configuring an AWS integration, you will be presented with four fields:

   * **Destination Name** is the unique identifier and display name for this integration. It cannot be changed.
   * **External ID** is a unique auto-generated value used in your AWS account to securely delegate access to HCP Vault Secrets. It will be needed when configuring your AWS IAM role.
   * **Role ARN** is a AWS IAM role identifier that HCP Vault Secrets will assume in your AWS account. [Instructions](#create-iam-role) to provision this role can be found below.
   * **Region** is the AWS region where your app secrets will be stored.

   ![Add sync destination UI](/img/docs/vault-secrets/ui-add-sync-destination.png)

1. Once all fields are populated, click **Save and sync secrets** to complete the
   configuration process. It will immediately sync all your existing app secrets
   into your AWS Secrets Manager.

Going forward, all modification to the app's secrets are automatically replicated in your AWS account almost instantly.

## Create IAM Role

The following sections provide step-by-step guidance to configure the AWS IAM role in your AWS account that HCP Vault Secrets will assume using the AWS console or HashiCorp Terraform.


<Tabs>
<Tab heading="AWS Console">

1. Navigate to the [Create New Policy](https://console.aws.amazon.com/iam/home#/policies$new?step=edit) section in the AWS IAM service
   1. Select the JSON tab
   1. Paste the following into the permissions policy editor:

      ```json
      {
         "Version": "2012-10-17",
         "Statement": [
            {
                  "Sid": "HCPVaultSecretsAccess",
                  "Effect": "Allow",
                  "Action": [
                     "secretsmanager:DescribeSecret",
                     "secretsmanager:GetSecretValue",
                     "secretsmanager:CreateSecret",
                     "secretsmanager:PutSecretValue",
                     "secretsmanager:UpdateSecret",
                     "secretsmanager:UpdateSecretVersionStage",
                     "secretsmanager:DeleteSecret",
                     "secretsmanager:RestoreSecret",
                     "secretsmanager:TagResource",
                     "secretsmanager:UntagResource"
                  ],
                  "Resource": "*"
            }
         ]
      }
      ```
   1. Optionally provide tags
   1. Name your policy
   1. Click Create Policy

1. Navigate to the [Create New Role](https://console.aws.amazon.com/iamv2/home#/roles/create?step=selectEntities) section in the AWS IAM service
   1. Select Custom trust policy option
   1. Paste the following into the trust policy editor:

      ```json
      {
          "Version": "2012-10-17",
          "Statement": [
              {
                  "Effect": "Allow",
                  "Principal": {
                      "AWS": "arn:aws:iam::879554817125:role/HCPVaultSecrets_Sync"
                  },
                  "Action": "sts:AssumeRole",
                  "Condition": {
                      "StringEquals": {
                          "sts:ExternalId": "<AWS_EXTERNAL_ID>"
                      }
                  }
              }
          ]
      }
      ```

   1. Populate the `<AWS_EXTERNAL_ID>` value with the AWS External ID of your HCP project.

       <Note>
       Your External ID can be found by navigating to the AWS sync integration page in HCP.
       </Note>

   1. Attach the Policy that was created in the previous step
   1. Name your role
   1. Click Create Role

1. View the Role you created and copy its ARN

1. You now have everything you need to complete the [configuration](#configuration) process!

</Tab>
<Tab heading="Terraform">

You can equally use the Terraform [AWS provider](https://registry.terraform.io/providers/hashicorp/aws/latest) to
provision an AWS IAM role with the appropriate policy.

1. Follow the [Terraform
   documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#authentication-and-configuration)
   to authenticate the AWS provider.

1. Use your preferred text editor and create a Terraform configuration file with
   the following resources:

   ```hcl
   provider "aws" {
     // See https://registry.terraform.io/providers/hashicorp/aws/latest/docs#authentication-and-configuration
     // for options on how to configure this provider. The following parameters or environment
     // variables are typically used.

     // Parameters:
     // access_key = ""
     // secret_key = ""
     // region     = ""

     // Environment variables:
     // AWS_ACCESS_KEY_ID
     // AWS_SECRET_ACCESS_KEY
     // AWS_REGION
   }

   variable "external_id" {
     type = string
     description = "External ID to securely delegate access to HCP Vault Secrets"
     sensitive = true
   }

   resource "aws_iam_role" "hashicorp_vault_secrets_role" {
     name = "HCPVaultSecrets"
     assume_role_policy = jsonencode({
       Version = "2012-10-17"
       Statement = [
         {
           Action = "sts:AssumeRole"
           Effect = "Allow"
           Principal = {
             AWS = "arn:aws:iam::879554817125:role/HCPVaultSecrets_Sync"
           }
           Condition = {
             StringEquals = {
               "sts:ExternalId" = var.external_id
             }
           }
         }
       ]
     })

     inline_policy {
       name   = "HCPVaultSecrets"
       policy = data.aws_iam_policy_document.hashicorp_vault_secrets_policy.json
     }
   }

   data "aws_iam_policy_document" "hashicorp_vault_secrets_policy" {
     statement {
       effect = "Allow"
       actions = [
         "secretsmanager:DescribeSecret",
         "secretsmanager:GetSecretValue",
         "secretsmanager:CreateSecret",
         "secretsmanager:PutSecretValue",
         "secretsmanager:UpdateSecret",
         "secretsmanager:UpdateSecretVersionStage",
         "secretsmanager:DeleteSecret",
         "secretsmanager:RestoreSecret",
         "secretsmanager:TagResource",
         "secretsmanager:UntagResource"
       ]
       resources = ["*"]
     }
   }

   output "role_arn" {
     description = "Role ARN to configure the AWS Secrets Manager Integration"
     value = aws_iam_role.hashicorp_vault_secrets_role.arn
   }
   ```

1. Initialize Terraform.

   ```shell-session
   $ terraform init
   ```

   This will prepare a working directory:

   <CodeBlockConfig hideClipboard>

   ```plaintext
   ...snip...

   Terraform has been successfully initialized!
   ```
   </CodeBlockConfig>

1. Generate your AWS IAM role with the apply command:

   ```shell-session
   $ terraform apply
   ```

   When prompted, paste the External ID value of your HCP project:

   <Note>
   Your External ID can be found by navigating to the AWS sync integration page in HCP.
   </Note>

   <CodeBlockConfig hideClipboard>

   ```plaintext
   ...snip...

   var.external_id
     External ID to securely delegate access to HCP Vault Secrets

     Enter a value: <AWS_EXTERNAL_ID>
   ```

   </CodeBlockConfig>

   Review the actions Terraform is about to perform and say `yes` to accept the plan:

   <CodeBlockConfig hideClipboard>

   ```plaintext
   ...snip...

   Plan: 1 to add, 0 to change, 0 to destroy.

   Changes to Outputs:
      + role_arn = (known after apply)

   Do you want to perform these actions?
      Terraform will perform the actions described above.
      Only 'yes' will be accepted to approve.

   Enter a value: yes
  ```

  </CodeBlockConfig>

1. Copy the AWS IAM Role from the Terraform outputs:

   <CodeBlockConfig hideClipboard>

   ```plaintext
   Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

   Outputs:

   role_arn = "arn:aws:iam::123456789012:role/HCPVaultSecrets"
   ```

   </CodeBlockConfig>

1. You now have everything you need to complete the
   [configuration](#configuration) process!

</Tab>
</Tabs>
