---
page_title: Audit Log Streaming
description: |-
  This topic describes HCP Boundary's audit log streaming capabilities
---

# Audit Log Streaming

## Introduction
HCP Boundary supports near real-time streaming of audit events to existing customer managed accounts of supported providers. Audit events capture all create, list, update or delete operations performed by a authenticated Boundary client (Desktop, CLI or the browser based admin UI) on any of the following resources within Boundary. This includes the user ID performing the operation, the timestamp and the full request and response payloads.
- Sessions
- Scopes
- Workers
- Credential Stores, Credential Libraries, Credentials
- Auth Methods, Roles, Managed Groups, Groups, Users, Accounts, Grants
- Host Catalogs, Host Sets, Host, Targets

Audit logs allow administrators to track user activity and enable security teams to ensure compliance in accordance with regulatory requirements.

The following section outlines the steps required to enable and configure audit logs streaming to supported providers. Currently Datadog and AWS CloudWatch 
are supported and customers may only stream to one account at a time.

## AWS Cloudwatch 
~> **Note:** Before you begin, you will need to have an [IAM role](https://docs.aws.amazon.com/iam/?id=docs_gateway) that can be assumed by the HashiCorp logging AWS 
account. Below are steps to create the IAM role with the specific HashiCorp information you will need. 

### Creating an IAM Role From the AWS Console

#### Create IAM Policy
1. **AWS Console** -> **IAM Service** -> **Policies** -> **Create Policy**
2. Choose JSON and use this policy

 ```json
 {
 	"Version": "2012-10-17",
 	"Statement": [
 		{
 			"Sid": "HCPLogStreaming",
 			"Effect": "Allow",
 			"Action": [
 				"logs:PutLogEvents",
 				"logs:DescribeLogStreams",
 				"logs:DescribeLogGroups",
 				"logs:CreateLogStream",
 				"logs:CreateLogGroup",
 				"logs:TagLogGroup"
 			],
 			"Resource": "*"
 		}
 	]
 }
 ```

3. Finish the rest of the setup

#### Create IAM Role
1. **AWS Console** -> **IAM Service** -> **Roles** -> **Create a New Role**
2. Choose **AWS account**
3. Trusted entity type: choose **AWS Account**
4. An AWS account: choose **Another AWS account**
5. Account ID: **711430482607**
6. Options: select **Require external ID**
7. External ID: Use what is provided on the HCP Audit log page for you. Reference the screenshots below of the Enable Log Streaming page for AWS CloudWatch.
8. Create custom policy
9. Attach the new policy to the role
10. Finish the rest of the creation steps

#### Create IAM Role Using Terraform
~> **Note:** You will need the Hashicorp generated external ID on the HCP Audit log page within the Portal.

```hcl
data "aws_iam_policy_document" "allow_hcp_to_stream_logs" {
 statement {
   effect = "Allow"
   actions = [
     "logs:PutLogEvents",       # To write logs to cloudwatch
     "logs:DescribeLogStreams", # To get the latest sequence token of a log stream
     "logs:DescribeLogGroups",  # To check if a log group already exists
     "logs:CreateLogGroup",     # To create a new log group
     "logs:CreateLogStream"     # To create a new log stream
   ]
   resources = [
     "*"
   ]
 }
}

data "aws_iam_policy_document" "trust_policy" {
 statement {
   sid     = "HCPLogStreaming"
   effect  = "Allow"
   actions = ["sts:AssumeRole"]
   principals {
     identifiers = ["711430482607"]
     type        = "AWS"
   }
   condition {
     test     = "StringEquals"
     variable = "sts:ExternalId"
     values = [
       "<ExternalID-generated-by-Hashicorp>"
     ]
   }
 }
}

resource "aws_iam_role" "role" {
 name               = "hcp-log-streaming"
 description        = "iam role that allows hcp to send logs to cloudwatch logs"
 assume_role_policy = data.aws_iam_policy_document.trust_policy.json
 inline_policy {
   name   = "inline-policy"
   policy = data.aws_iam_policy_document.allow_hcp_to_stream_logs.json
 }
}
```
Once you have finished your AWS setup, you can complete the log streaming setup in the HCP Portal. 

1. From the HCP Boundary **Overview** page, select the **Audit Logs** view.

  ![Enable audit log streaming](/img/docs/boundary/enable-logs.png)

2. Click **Enable Log Streaming**.
3. From the **Enable audit logs streaming** view, select **AWS CloudWatch** as the provider
4. Under the **provider**, enter your **Destination name**, **Role ARN**, and select the **AWS region** that matches where you want your data stored.

  ![AWS audit log configuration](/img/docs/boundary/aws-enable-logs.png)

5. Click **Save**
Logs should arrive within your AWS CloudWatch environment in a few minutes after Boundary usage. 

~> **Note:** We dynamically create the log group and log streams for you. You can find the Log group in your AWS CloudWatch with the prefix “/hashicorp” after setting up your configuration. This will allow you to clearly see logs coming from HashiCorp separately from other log inputs you may have in CloudWatch. 

Refer to the [AWS documentation](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html) for details on log exploration.


## Datadog
~> **Note:** You will need to know which region your Datadog account is in and have your Datadog [API key](https://docs.datadoghq.com/account_management/api-app-keys/) handy. 

1. From the HCP Boundary **Overview** page, select the **Audit Logs** view.

  ![Enable audit log streaming](/img/docs/boundary/enable-logs.png)

2. Click **Enable Log Streaming**.
3. From the **Enable audit logs streaming** view, select **Datadog** as the provider
4. Under the **provider**, enter your **Destination name**, **API Key** and select the **Datadog site region** that matches your existing Datadog environment.

  ![Datadog audit log configuration](/img/docs/boundary/datadog-enable-logs.png)

5. Click **Save**

Logs should arrive within your Datadog environment in a few minutes after Boundary usage. 
Refer to the [Datadog documentation](https://docs.datadoghq.com/getting_started/logs/#explore-your-logs) for details on log exploration.

## Testing Streaming Configuration

During the streaming configuration setup, you may test that the streaming configuration is working within HCP. This can be helpful when you want to verify you entered correct credentials and other parameters on the configuration plan. To test, enter the needed parameters for the logging provider you wish to test, then press the “Test connection” button.

  ![Test Connection button](/img/docs/boundary/test-connection.png)

HCP will send a test message to the logging provider and share the status of success or failure within the “Enable log streaming” page.  

Testing a configuration also works when you are updating your streaming configuration that you have already configured. 

## Updating Streaming Configuration

After you have configured streaming, you may want to update the configuration for various reasons. You may want to rotate a secret used for your logging provider or you may want to switch logging providers all together. 

   ![Update Connection menu](/img/docs/boundary/update-connection.png)


1. Select the “Edit streaming configuration” button under the Manage menu on the “Audit logs” page. 
2. If you wish to select a new provider, do so now.
3. Enter new parameters for the provider.
4. (Optional) Test the connection by pressing the “Test connection” button
5. Press “Save”


## Retention
Audit logs are stored within the platform for a minimum of 1 year. HCP began archiving audit logs in October of 2022.  The logs are also available after the 
deletion of the cluster that created them. Please contact HashiCorp Support if you need access to logs from deleted clusters or have further questions. 



