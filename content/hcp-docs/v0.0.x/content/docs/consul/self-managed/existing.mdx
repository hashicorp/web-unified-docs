---
page_title: Link existing self-managed clusters
description: |-
  Learn how to use HCP Consul to link existing self-managed Consul clusters on VMs or Kubernetes to HCP Consul Central. On k8s, you can use either the consul-k8s CLI or Helm to link existing clusters.
---

# Link existing self-managed clusters

This page describes the process for linking an existing self-managed cluster to HCP Consul Central. By linking an existing self-managed cluster, you are able to take advantage of HCP Consul Central’s features, such as observability insights and global workflows, while retaining full management over your cluster.

Kubernetes users have the option to use either Consul on Kubernetes or Helm. To get started with the `consul-k8s` CLI, refer to the [installation guide in the Consul documentation](/consul/docs/k8s/installation/install-cli).

## Prerequisites

Linking a self-managed cluster is supported in Consul v1.14.7, v1.15.3, and later. If necessary, [upgrade your existing cluster](/consul/docs/upgrading/instructions) before attempting to link it to HCP.

The `consul-k8s` CLI supports linking clusters to HCP in v1.0.7, v1.1.2, and later.

Your cluster must have ACLs enabled and the ACL system must be bootstrapped in order to link it to HCP Consul in read-only mode. To enable Consul's ACL system:

- On VMs, set `acl.enabled=true` in the [agent's configuration file](/consul/docs/agent/config/config-files#acl).
- On Kubernetes, set `global.acls.manageSystemACLs: true` in the [Consul Helm chart](/consul/docs/k8s/helm#v-global-acls-managesystemacls).

The `consul-k8s` CLI automatically bootstraps ACLs on your behalf when you update `global.acls.manageSystemACLs` in your `values.yaml` configuration and apply the change to your cluster. To manually bootstrap ACLs so that HCP can link to it, you must [create the initial management token](/consul/tutorials/day-0/access-control-setup#create-the-initial-management-token).

## Link an existing self-managed-cluster

Follow the instructions according to your existing cluster’s runtime. After you successfully initiate the link, HCP Consul may take up to 10 minutes to create the access policies that allow users with other HCP roles to access the cluster. Refer to [user roles and ACL policies](/hcp/docs/consul/self-managed#user-roles-and-acl-policies) for more information.

<Tabs>

<Tab heading="Virtual Machines (VMs)">

To link an existing self-managed Consul cluster running on virtual machines, complete the following steps:

1. From the HCP Consul overview, click **Create or link a Consul cluster**.
1. Select **Self-managed Consul**.
1. Click **Link existing** and then **Get Started**.
1. Enter a name for your cluster. This name must have 3 to 36 characters and be unique to your organization. This name does not need to match names in your existing deployment. It is used only within the management plane service to identify your linked cluster.
1. Click **Virtual machine**.
1. Optionally, click **Read-only** and enter the `SecretID` of a dedicated ACL token. For help creating this token, refer to [Add a dedicated read-only token for HCP Consul](/hcp/docs/consul/self-managed/read-only). For information about the difference between linking a cluster in read/write or read-only mode, refer to [cluster access permissions](/hcp/docs/consul/concepts/cluster-permissions).
1. Click **Continue**.

HCP Consul then [generates credentials to authenticate and connect your self-managed cluster](/hcp/docs/consul/self-managed#how-the-linking-process-works) and provides them in a JSON code snippet that contains the entire [`Cloud` configuration block](/consul/docs/agent/config/config-files#self-managed-hcp-parameters) required to link the cluster to HCP.

Add the `Cloud` configuration block to the agent configuration file and then restart the `consul` service on each server.

You can also merge the configuration block into your existing agent configuration. For this approach, complete the following steps:

1. Copy the JSON configuration and paste it into a `config.json` file. Add `config.json` to the same directory as your agent’s configuration file.
1. Run `consul leave` to stop running the server agent.
1. Run `consul agent -server -config-dir=<path>` to load and merge the agent configurations.

After the agent restarts, the linking process begins automatically. When the linking process is complete, your self-managed cluster appears in the list on the Consul overview. When you click its name, HCP Consul Central shows information about the cluster, such as individual server IP addresses and port assignments, as well as the cluster’s current health status.

</Tab>

<Tab heading="consul-k8s">

To link an existing self-managed Consul cluster running on Kubernetes, complete the following steps:

1. From the HCP Consul overview, click **Create or link a Consul cluster**.
1. Select **Self-managed Consul**.
1. Click **Link existing** and then **Get Started**.
1. Enter a name for your cluster. This name must have 3 to 36 characters and be unique to your organization. This name does not need to match names in your existing deployment. It is used only within the management plane service to identify your linked cluster.
1. Click **Kubernetes**.
1. Optionally, click **Read-only** and enter the `SecretID` of a dedicated ACL token. For help creating this token, refer to [Add a dedicated read-only token for HCP Consul](/hcp/docs/consul/self-managed/read-only). For information about the difference between linking a cluster in read/write or read-only mode, refer to [cluster access permissions](/hcp/docs/consul/concepts/cluster-permissions).
1. Click **Continue**.
1. Click **Consul-K8s CLI** to generate the appropriate CLI commands.

  HCP Consul then [generates credentials to authenticate and connect your self-managed cluster](/hcp/docs/consul/self-managed#how-the-linking-process-works) and provides them in a series of code snippets. These snippets contains all of the information needed to create and link your cluster.

1. Copy the `kubectl` commands in the first code block and run them in the CLI to set Kubernetes secrets for securely connecting your new cluster to HCP. If necessary for your network, edit the `--namespace=consul` flag at the end of each command to match the namespace where you deployed Consul.
1. If you do not have a `values.yaml` file already, run `consul-k8s config read > values.yaml` to create one.
1. Copy the `cloud` configuration stanza and add it to your `values.yaml` file. Nest the stanza under the `global` value, as demonstrated in the following example:

  ```yaml
  global:
    cloud:
      enabled: true
      resourceId:
        secretName: "consul-hcp-resource-id"
        secretKey: "resource-id"
      clientId:
        secretName: "consul-hcp-client-id"
        secretKey: "client-id"
      clientSecret:
        secretName: "consul-hcp-client-secret"
        secretKey: "client-secret"
  ```

1. Copy the `consul-k8s upgrade` command and run it in the CLI.

The linking process begins automatically. After the linking process is complete, your self-managed cluster appears in the list on the Consul overview. When you click its name, HCP Consul Central shows information about the cluster, such as individual server IP addresses and port assignments, as well as the cluster’s current health status.

</Tab>

<Tab heading="Helm">

To link an existing self-managed Consul cluster running on Kubernetes, complete the following steps:

1. From the HCP Consul overview, click **Create or link a Consul cluster**.
1. Select **Self-managed Consul**.
1. Click **Link existing** and then **Get Started**.
1. Enter a name for your cluster. This name must have 3 to 36 characters and be unique to your organization. This name does not need to match names in your existing deployment. It is used only within the management plane service to identify your linked cluster.
1. Click **Kubernetes**.
1. Optionally, click **Read-only** and enter the `SecretID` of a dedicated ACL token. For help creating this token, refer to [Add a dedicated read-only token for HCP Consul](/hcp/docs/consul/self-managed/read-only). For information about the difference between linking a cluster in read/write or read-only mode, refer to [cluster access permissions](/hcp/docs/consul/concepts/cluster-permissions).
1. Click **Continue**.
1. Click **Helm** to generate the appropriate CLI commands.

  HCP Consul then [generates credentials to authenticate and connect your self-managed cluster](/hcp/docs/consul/self-managed#how-the-linking-process-works) and provides them in a series of code snippets. These snippets contains all of the information needed to create and link your cluster.

1. Copy the `kubectl` commands in the first code block and run them in the CLI to set Kubernetes secrets for securely connecting your new cluster to HCP. If necessary for your network, edit the `--namespace=consul` flag at the end of each command to match the namespace where you want to deploy Consul.
1. Copy the `cloud` configuration stanza and add it to your Helm values file. Nest the stanza under the `global` value, as demonstrated in the following example:

  ```yaml
  global:
    cloud:
      enabled: true
      resourceId:
        secretName: "consul-hcp-resource-id"
        secretKey: "resource-id"
      clientId:
        secretName: "consul-hcp-client-id"
        secretKey: "client-id"
      clientSecret:
        secretName: "consul-hcp-client-secret"
        secretKey: "client-secret"
  ```

1. Copy the `helm upgrade consul` command and run it in the CLI.  If necessary for your network, edit the `--namespace=consul` flag at the end of the command to match the namespace where you want to deploy Consul.

The linking process begins automatically. After the linking process is complete, your self-managed cluster appears in the list on the Consul overview. When you click its name, HCP Consul Central shows information about the cluster, such as individual server IP addresses and port assignments, as well as the cluster’s current health status.

</Tab>
</Tabs>

Once your self-managed cluster is successfully linked, HCP Consul Central may take up to 10 minutes to create the access policies that allow users with other HCP roles to access the cluster. Refer to [user roles and ACL policies](/hcp/docs/consul/self-managed#user-roles-and-acl-policies) for more information.

## Unlink self-managed clusters

To unlink a self-managed cluster, you must use HCP to remove the link. If you delete a cluster without unlinking it from HCP first, the cluster will continue to appear in HCP as an unhealthy cluster.

In the Consul overview section of HCP Consul Central, click the name of the self-managed cluster you want to unlink. Then, click **Manage** and then **Unlink from HCP**. Type `UNLINK` in the text entry field and then click **Unlink** to confirm.

HCP Consul cannot access your self-managed cluster after you unlink it. However, the self-managed cluster retains the management token that HCP Consul Central created and used. If you plan on using your self-managed cluster without HCP Consul, use the [`consul acl token`](/consul/commands/acl/token) command to list and delete tokens associated with the cluster.

## Next steps

To learn more about what you can do with your self-managed cluster after you link it to HCP Consul, refer to the following topics:

- [HCP Consul Central overview](/hcp/docs/consul/monitor/consul-central)
- [Consul observability](/hcp/docs/consul/monitor/consul-central/observability)
- [Establish cluster peering connections on HCP Consul](/hcp/docs/consul/extend/cluster-peering/establish)
