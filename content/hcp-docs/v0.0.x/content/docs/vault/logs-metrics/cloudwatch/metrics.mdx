---
page_title: Configure HCP Vault metric streaming to Amazon CloudWatch
sidebar_title: Amazon CloudWatch
description: |-
  Configure HCP Vault metric streaming to Amazon CloudWatch
---

# Configure HCP Vault metric streaming to Amazon CloudWatch

For details on metrics scope and interpretation, see the [HCP Vault metrics
documentation](/hcp/docs/vault/logs-metrics).

<Note title="Availability">

HCP Vault metrics streaming is available for all
production grade clusters. The feature is not available for Development tier
clusters.

</Note>

## Prerequisites

To configure metric streaming to Amazon CloudWatch, you will need
to have:

- A HCP account with Admin or Contributor [role assigned in HCP](/hcp/docs/hcp/create-account)
- A production grade HCP Vault cluster
- Access to AWS with permission to create IAM policies and users

   <Note>

   If you do not have a cluster running, refer to the [Create a Vault Cluster on
   HCP](/vault/tutorials/cloud/get-started-vault) or  the [Deploy HCP Vault with
   Terraform](/vault/tutorials/cloud-ops/terraform-hcp-provider-vault) tutorial to create an HCP Vault
   cluster.

   </Note>

## Configure AWS

To configure HCP Vault metric streaming to Amazon CloudWatch, you must provide
an access and secret key for an IAM user assigned permission to CloudWatch.

### Create IAM policy

1. Log in to the AWS Management Console and navigate to the IAM Dashboard.

1. Click **Policies**, then click **Create policy**.

1. Click the **JSON** tab and paste the IAM policy into the **Policy editor** textbox overwriting any sample text.

   ```json
   {
       "Version": "2012-10-17",
       "Statement": [
           {
               "Sid": "HCPMetricStreaming",
               "Effect": "Allow",
               "Action": [
                   "cloudwatch:ListMetrics",
                   "cloudwatch:ListMetricStreams",
                   "cloudwatch:ListTagsForResource",
                   "cloudwatch:PutMetricData",
                   "cloudwatch:PutMetricStream",
                   "cloudwatch:TagResource"
               ],
               "Resource": "*"
           }
       ]
   }
   ```

1. Click **Next**.

1. Enter `hcp-vault-metric-streaming` in the **Policy name** textbox and click **Create policy**.

### Create IAM user

1. From the IAM Dashboard, click **Users**.

1. Click **Add users**.

1. Enter `hcp-vault-metric-streaming` in the **User name** textbox and click **Next**.

1. Click the **Attach policies directly** radio button.

1. Search for the `hcp-vault-metric-streaming` policy, click the checkbox, and click **Next**.

   <Note>

   This document has you attach the policy directly to the IAM user for ease of following the documentation.

   The recommended practice is to create an IAM group, attach the policy to the group, and add the user to the group.

   </Note>

1. Click **Create user**.

1. Click the **hcp-vault-metric-streaming** user in the **Users** list.

1. Click the **Security credentials** tab and click **Create access key**.

1. Select **Application running outside AWS** and click **Next**.

1. Click **Create access key**.

1. Securely store the **Access key** and **Secret access key** values  - you will need this to configure metric streaming in the HCP Portal.

## Enable metrics streaming

1. Log in to the HCP Portal and navigate to the **Vault clusters** page.

1. Click the Vault cluster you wish to enable streaming for and click **Metrics**.

1. Click **Enable metric streaming**.

1. From the **Stream Vault metrics** view, select **Amazon CloudWatch** as the provider and click **Next**.

1. Under **Add provider details**, enter the **Access key ID** and **Secret access key** created in the
   [Create IAM user section](#create-iam-user), then select the **Region** that matches your existing
   CloudWatch environment.

1. Click **Save**.

   <Note>

   At this time, HCP Vault only supports metrics streaming to one
   metrics endpoint at a time.

   </Note>

## Example Terraform configuration (optional)

Refer to the Terraform Registry [`hcp_vault_cluster` documentation](https://registry.terraform.io/providers/hashicorp/hcp/latest/docs/resources/vault_cluster#metrics_config)
for more information.

```hcl
resource "hcp_vault_cluster" "example" {
  cluster_id = "vault-cluster"
  hvn_id     = hcp_hvn.example.hvn_id
  tier       = "standard_large"
  metrics_config {
    cloudwatch_access_key_id = "actual-access-key-id"
    cloudwatch_secret_access_key = "actual-secret-access-key"
    cloudwatch_region = "countrycode-region-#"
  }
}
```

## Edit the metrics streaming configuration (optional)

To edit a metrics streaming integration, perform the following steps.

1. From the **Metrics** page, click on the **Manage** drop-down, then **Edit
   configuration**.

1. Edit the configuration, then click **Save**.

## Disable metrics streaming (optional)

To disable a metrics streaming integration, from the **Metrics** page, click on
the **Manage** drop-down, then **Disable streaming**.