---
page_title: Create a HCP Consul Dedicated cluster
description: |-
  Learn how to create a HCP Consul Dedicated Consul cluster using the HashiCorp Cloud Platform (HCP) interface.
---

# Create a HCP Consul Dedicated cluster

@include 'alerts/consul-dedicated-eol.mdx'

This page describes how to create *HCP Consul Dedicated clusters*, which are one or more Consul server agents that are installed, configured, and managed for you by HashiCorp.

## Prerequisites

Before you create a Consul cluster, configure the following HCP components:

- A HashiCorp virtual network (HVN)
    - [Create and Manage an HVN on AWS](/hcp/docs/hcp/network/hvn-aws/hvn-aws)
    - [Create and Manage an HVN on Azure](/hcp/docs/hcp/network/hvn-azure/hvn-azure)
- A peering connection or transit gateway attachment
    - [Peering Connections on AWS](/hcp/docs/hcp/network/hvn-aws/hvn-peering)
    - [Transit Gateway Attachments on AWS](/hcp/docs/hcp/network/hvn-aws/tgw-attach)
    - [Peering Connections on Azure](/hcp/docs/hcp/network/hvn-azure/hvn-peering)
- Routes for directing network traffic between the HVN and a target connection
    - [Routes on AWS](/hcp/docs/hcp/network/hvn-aws/routes)
    - [Routes on Azure](/hcp/docs/hcp/network/hvn-azure/routes)

## Create a Consul cluster

<Tabs>
<Tab heading="HCP UI" group="hcp">

1. Sign in to the [HCP Portal](https://portal.cloud.hashicorp.com).
1. Select the organization or project where you want to create the cluster. Because resources such as HVNs are associated with an individual project, you must create the cluster in the same project as the HVN peering that supports it.
1. Click **Consul**.
1. From the Consul Overview, click **Deploy Consul**.
1. Select **HCP Consul Dedicated** and then click **Get Started**.
1. Select the cloud provider where you host your services and then click **Next**.
1. Select **HCP UI Workflow** and then click **Next**.
1. Choose the HVN where you want to deploy your clusters. You should configure the HVN for the same environment where your Consul agents are deployed. If an appropriate HVN for your environment does not exist, click **Create new network** and then [create a new HVN](/hcp/docs/hcp/network).
1. Enter a name for the cluster in the **Cluster ID** field. The cluster ID is a unique identifier that cannot be used for other active HCP Consul Dedicated clusters.
1. Select a cluster tier. Each tier enables a different set of Consul server features. Refer to [cluster tiers](/hcp/docs/consul/concepts/cluster-tiers) for more information.
1. Select a cluster size. Cluster size is measured by the expected number of service instances the cluster supports. For example, a small cluster supports up to 500 service instances. For pricing information for each cluster size, refer to [HCP Consul Dedicated Pricing](https://www.hashicorp.com/products/consul/pricing).
1. Choose whether the cluster should be private or public. If you want to be able to access the Consul cluster UI from an external network, select **Public**. For production environments, we recommend using private Consul clusters.

    - Public access is less secure. We do not recommend enabling this option for production servers.
    - For additional security, enable **Allow select IPs only**. This option lets you whitelist up to three IPV4 address ranges in CIDR notation. 

1. Choose the Consul version for your server agents. If you do not require a specific version, we recommend choosing the default option, which is the latest release of Consul.
1. Click **Create cluster**.

HCP then begins cluster creation. It takes about 10 minutes for the operation to finish. Wait until your cluster is created before connecting clusters and deploying agents.

</Tab>

<Tab heading="Terraform automation for AWS" group="aws">

HCP includes an option to generate Terraform code that you can run to create a Consul cluster in AWS. The Terraform code deploys Consul to either a new VPC or an existing VPC. It also deploys a demo application that you can interact with and observe in the Consul UI.

1. Sign in to the [HCP Portal](https://portal.cloud.hashicorp.com).
1. Select the organization or project where you want to create the cluster. Because resources such as HVNs are associated with an individual project, you must create the cluster in the same project as the HVN peering that supports it.
1. Click **Consul**.
1. From the Consul Overview, click **Deploy Consul**.
1. Select **HCP Consul Dedicated** and then click **Get Started**.
1. Select **Amazon Web Services** and then click **Next**.
1. Select **Terraform automation** and then click **Next**.
1. If you need to create a new VPC for your cluster, click **Create new VPC**. Otherwise, continue with the configuration for **Use an existing VPC**.
1. Select a runtime for your cluster. HCP Consul Dedicated supports EKS, EC2, and ECS runtimes for clusters.
1. Choose a region from the **HCP Region** menu. This region is where you want to create the Consul server. If you are connecting to an existing VPC, we recommend creating the cluster in the same region as your VPC in order to reduce latency.
1. Under **VPC Region**, select a region. This region is where your existing VPC is located or where you want to create your new VPC.
1. Specify the networking information for the existing VPC. Specify the **VPC ID**, **Private route table ID**, **Private subnet 1**, and **Private subnet 2**, if applicable.
1. If you have not already generated them, click **Generate service principal and key**. Copy the provided code and run it in your CLI to export credentials. This step authenticates Terraform for interactions with HCP. For more information, refer to [Service Principals](/hcp/docs/hcp/admin/service-principals).
1. Copy the Terraform configuration file generated on HCP. Save this code as `main.tf` in your Terraform directory.
1. Initialize the directory:

    ```shell-session
    $ terraform init
    ```

1. Preview the Terraform plan:

    ```shell-session
    $ terraform plan
    ```

1. If no adjustments are necessary, apply the configuration to build the infrastructure:

    ```shell-session
    $ terraform apply -auto-approve
    ```

The building process takes about 10 minutes to complete.

After Terraform starts, the cluster appears in the list of Consul clusters in HCP. You can click the name of your cluster to view details, connect a VPC to your cluster, and access the Consul clusterâ€™s UI.

Wait until cluster creation is complete before you proceed.

</Tab>
<Tab heading="Terraform automation for Azure" group="azure">

HCP includes an option to generate Terraform code that you can run to create a Consul cluster in Azure. The Terraform code deploys Consul to either a new VNet or an existing VNet. It also deploys a demo application that you can interact with and observe in the Consul UI.

1. Sign in to the [HCP Portal](https://portal.cloud.hashicorp.com).
1. Select the organization or project where you want to create the cluster. Because resources such as HVNs are associated with an individual project, you must create the cluster in the same project as the HVN peering that supports it.
1. Click **Consul**.
1. From the Consul Overview, click **Deploy Consul**.
1. Select **HCP Consul Dedicated** and then click **Get Started**.
1. Select **Microsoft Azure** and then click **Next**.
1. Select **Terraform automation** and then click **Next**.
1. If you need to create a new VNet for your cluster, click **Create new VNet**. Otherwise, continue with the configuration for **Use an existing VNet**.
1. Select a runtime for your cluster. HCP Consul Dedicated supports AKS and Azure VM runtimes for clusters.
1. Choose a region from the **HCP Region** menu. This region is where you want to create the Consul server. If you are connecting to an existing VPC, we recommend creating the cluster in the same region as your VPC in order to reduce latency.
1. Specify the networking information for the existing VNet. Specify the **VNet name**, **Resource group name**, **Azure subscription ID**, **Subnet 1**, and **Subnet 2**, if applicable.
1. If you have not already generated them, click **Generate service principal and key**. Copy the provided code and run it in your CLI to export credentials. This step authenticates Terraform for interactions with HCP. For more information, refer to [Service Principals](/hcp/docs/hcp/admin/service-principals).
1. Copy the Terraform configuration file generated on HCP. Save this code as `main.tf` in your Terraform directory.
1. Initialize the directory:

    ```shell-session
    $ terraform init
    ```

1. Preview the Terraform plan:

    ```shell-session
    $ terraform plan
    ```

1. If no adjustments are necessary, apply the configuration to build the infrastructure:

    ```shell-session
    $ terraform apply -auto-approve
    ```

HCP begins to create the cluster. It takes about 10 minutes for the operation to finish. Wait until your cluster is created before connecting clusters and deploying agents.

> **Tutorial:** For step-by-step guidance on deploying HCP Consul Dedicated on Azure using Terraform automation, refer to the [Deploy HCP Consul Dedicated on VMs using Terraform tutorial](/consul/tutorials/cloud-deploy-automation/consul-end-to-end-azure-vm).

</Tab>
</Tabs>

## Troubleshooting

You may encounter the following error when attempting to deploy a cluster in EKS using the code that HCP Consul provides:

<CodeBlockConfig hideClipboard>

```log
Error: "exec plugin: invalid apiVersion "client.authentication.k8s.io/v1alpha1"
```

</CodeBlockConfig>

This error occurs when using outdated versions of the AWS CLI and IAM authenticator. Upgrade both to the latest version, and then run the code provided by HCP to complete the process.

## Edit a cluster after creation

After you create the cluster, you can change the cluster size, edit the select IPs that can access the cluster, and update the Consul version. However, you cannot modify the cluster name, tier, or HVN after creating a cluster.

To edit an existing cluster, complete the following steps:

1. Sign in to the [HCP Portal](https://portal.cloud.hashicorp.com).
1. Select the organization or project where created the cluster you want to edit.
1. Click **Consul**.
1. From the Consul Overview, next to the cluster you want to edit, click the  and then **Edit cluster**.

HashiCorp automatically updates your Consul clusters to fix common vulnerabilities and exposures (CVE). To learn more about upgradeing your Consul version, refer to [Upgrade your network](/hcp/docs/consul/upgrade).