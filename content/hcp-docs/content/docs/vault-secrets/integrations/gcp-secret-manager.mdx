---
page_title: Integrate with GCP Secret Manager
sidebar_title: GCP Secret Manager
description: |-
  Describes how to set up automated synchronization of application secrets to GCP Secret Manager.
---

# Integrate with GCP Secret Manager

HCP Vault Secrets allows users to automatically synchronize application secrets
to GCP Secret Manager. This guide walks you through the configuration process.

## Prerequisites:

- Existing GCP project and billing account
- Secrets Manager API enabled in the target GCP project
- Cloud Resource Manager API enabled in the target GCP project
- Ability to create service accounts and keys
- An HCP Vault Secrets application and secret(s)

## Generating Service Account Key

The HCP Vault Secrets integration with GCP requires a service account and key in
the target GCP project.

Refer to the [Google Cloud IAM
documentation](https://cloud.google.com/iam/docs/service-accounts-create)
for more information.

<Tabs>
<Tab heading="GCP Console">

1. Navigate to the **Service Accounts** page in the Google Cloud Console.

1. Create a new service account.

1. Provide **Service account name** and desired **service account ID**.

1. Click **Create and Continue**.

1. Grant the service account the **Secret Manager Admin** role.

1. Click **Continue** and click **Done** at the bottom of the form.

1. Click the service account you created.

1. Click **Keys** and then click **Add Key**.

1. Under key type select **JSON**. This will automatically download your
   `credentials.json` file.

</Tab>
<Tab heading="GCP CLI">

1. Go to your terminal window

1. Export your GCP Project ID as an environment variable.

   ```shell-session
     $ export GCP_PROJECT_ID=<your project ID>
    ```

1. Set an active GCP project

   ```shell-session
    $ gcloud config set project $GCP_PROJECT_ID
    ```

1. Create a new Service Account

   ```shell-session
    $ gcloud iam service-accounts create hcp-vault-secrets \
      --description="<your description>" \
      --display-name="<your display name>"
   ```

1. Set a policy for the Service Account to administer secrets

    ```shell-session
    $ gcloud projects add-iam-policy-binding $GCP_PROJECT_ID \
      --member="serviceAccount:hcp-vault-secrets@$GCP_PROJECT_ID.iam.gserviceaccount.com" \
      --role="roles/secretmanager.admin"
    ```

1. Generate a service account key

    ```shell-session
    $ gcloud iam service-accounts keys create service-account-key.json \
      --iam-account="hcp-vault-secrets@$GCP_PROJECT_ID.iam.gserviceaccount.com";
    ```

</Tab>
<Tab heading="Terraform">

Use the Terraform [Google provider](https://registry.terraform.io/providers/hashicorp/google/latest/docs) to
provision a service account and key with the required policy attached.

1. Follow the [Terraform
   documentation](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference#authentication)
   to authenticate the Google provider.

1. Create a Terraform configuration file to create a service account and key.

   ```hcl
     provider "google" {
      // See https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference#authentication
      // for options on how to configure this provider. The following parameters or environment
      // variables are typically used.
      // Parameters:
      // credentials = ""
      // project = ""
      // region = ""
      // Environment variables:
      // GOOGLE_CREDENTIALS
      // GOOGLE_PROJECT
      // GOOGLE_REGION
    }

    data "google_project" "project" {}
    resource "google_service_account" "hcp_vault_secrets_integration" {
      account_id  = "hcp-vault-secrets-sync"
      description = "service account used by HCP Vault Secrets to sync secrets into the GCP secret manager service"
    }

    resource "google_project_iam_member" "hcp_vault_secrets_integration" {
      project = data.google_project.project.id
      role    = "roles/secretmanager.admin" # You can alternatively create a custom role with more narrow permissions
      member  = google_service_account.hcp_vault_secrets_integration.member
    }

    resource "google_service_account_key" "hcp_vault_secrets_integration" {
      service_account_id = google_service_account.hcp_vault_secrets_integration.name
      public_key_type    = "TYPE_X509_PEM_FILE"
    }

    resource "local_file" "hcp_vault_secrets_integration" {
      content  = base64decode(google_service_account_key.hcp_vault_secrets_integration.private_key)
      filename = "hvs-secrets-sync-credentials.json"
    }

    output "service_account_credentials_file_location" {
      value = abspath(local_file.hcp_vault_secrets_integration.filename)
    }
   ```

1. Initialize Terraform.

   ```shell-session
   $ terraform init

   ...snip...

   Terraform has been successfully initialized!
   ```

1. Run `terraform apply` to create a GCP service account and key.

   ```shell-session
   $ terraform apply
   ```

1. The generated file will be stored at the specified path.

   <CodeBlockConfig hideClipboard>

   ```plaintext
   Apply complete! Resources: 4 added, 0 changed, 0 destroyed.

   Outputs:

   service_account_credentials_file_location = "/home/john-doe/terraform-local/hvs-gcp-setup/hvs-secrets-sync-credentials.json"
   ```

   </CodeBlockConfig>

</Tab>
</Tabs>

## Configure GCP Secret Manager integration

1. Navigate to the HCP Vault Secrets app you would like to integrate with your
   GCP project. Select **Integrations** from the sidebar then click on the **GCP Secret Manager** card to initiate the setup.

   ![Integration - GCP Sync](/img/docs/vault-secrets/integration-select-cards-new.png)

   If this is your first time configuring a GCP integration, you will be presented with two simple fields:

   * **Name** is the unique identifier and display name for this integration. It cannot be changed.
   * **Service account credentials** is a unique credential file value used in your GCP account to securely delegate access to HCP Vault Secrets. You can either upload a credentials.json file or use the code block to paste it in. [Instructions](#generating-service-account-key) to provision this role can be found below.

   ![Add sync destination UI](/img/docs/vault-secrets/ui-add-gcp-destination.png)

1. Once all fields are populated, click **Save and sync secrets** to complete the
   configuration process. It will immediately sync all your existing app secrets
   into GCP Secret Manager.

   The synchronization of existing app secrets to GCP Secret Manager will
   begin. All future modifications to the app's secrets such as adding,
   updating, or deleting a secret are automatically
   replicated to GCP Secret Manager.