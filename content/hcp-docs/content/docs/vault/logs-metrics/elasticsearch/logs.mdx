---
page_title: Configure HCP Vault Dedicated audit log streaming to Elasticsearch
sidebar_title: Elasticsearch
description: |-
  Configure HCP Vault Dedicated audit log streaming to Elasticsearch
---

# Configure HCP Vault Dedicated audit log streaming to Elasticsearch

<Note title="Availability">

HCP Vault Dedicated audit logs streaming is available for all
production grade clusters. The feature is not available for Development tier
clusters.

</Note>

## Prerequisites

To configure audit logs streaming to Elasticsearch, you will need
to have:

- A HCP account with the Admin [role assigned](/hcp/docs/hcp/create-account)
- An essentials or standard tier HCP Vault Dedicated cluster
- An Elasticsearch cluster created in Elastic Cloud with permission to create a role, and a user.

   <Note>

   If you do not have a cluster running, refer to the [Create a Vault Cluster on
   HCP](/vault/tutorials/get-started-hcp-vault-dedicated/get-started-vault) or  the [Deploy HCP Vault Dedicated with
   Terraform](/vault/tutorials/cloud-ops/terraform-hcp-provider-vault) tutorial to create an HCP Vault Dedicated
   cluster.

   </Note>

## Configure Elastic Cloud

To configure HCP Vault Dedicated audit log streaming to Elasticsearch, you must provide
a endpoint URL, username, and password for a user that has been assigned a role with
adequate permission to the Elasticsearch cluster.

### Create role

1. Log in to the Elastic Cloud console and navigate to the stack management security page.

   For example `https://<your-elastic-cloud-url>:9243/app/management/security/`

1. Click **Roles**, then click **Create role**.

1. Enter `hcp-vault-log-streaming` in the **Role name** textbox.

1. In the **Cluster privileges** pull down, select **monitor**.

1. Under **Index privileges**, enter `*` in the **Indices** pulldown menu.

1. Click the **Privileges** pulldown menu and select the following:

   - **create**
   - **create_index**
   - **manage**
   - **manage_ilm**
   - **write**

1. Click **Create role**.

### Create user

1. From the stack management security page, click **Users**.

1. Click **Create user**.

1. Enter `hcp-vault-log-streaming` in the **Username** textbox.

1. Enter a secure password in the **Password** and **Confirm password** textbox. Make
   note of the username and password - you will need this to configure audit log streaming in [the HCP Portal](https://portal.cloud.hashicorp.com/).

1. Click the **Roles** pulldown menu and select the **hcp-vault-log-streaming** role.

1. Click **Create user**.

### Retrieve Elastic URL

1. Navigate to `https://cloud.elastic.co/home`.

1. Click **Manage** for the Elastic Cloud deployment you wish to send HCP Vault Dedicated audit logs to.

1. Under **Applications** click **Copy endpoint** for Elasticsearch. Make
   note of the endpoint URL - you will need this to configure audit log streaming in [the HCP Portal](https://portal.cloud.hashicorp.com/).

   The URL will be in the format of `https://123def789jkl.region.cloudprovider.es.io`.

## Enable audit logs streaming

1. Log in to [the HCP Portal](https://portal.cloud.hashicorp.com/) and navigate to the **Vault clusters** page.

1. Click the Vault cluster you wish to enable streaming for and click **Audit Logs**.

1. Click **Enable log Streaming**.

1. From the **Enable audit logs streaming** view, select **Elastic** as the
   provider and click **Next**.

1. Under **Elastic configuration**, enter the **Endpoint** URL, **Elastic user**, and **Elastic password** created in the [Create user section](#create-user).

1. Click **Save**.

   <Note>

   At this time, HCP Vault Dedicated only supports audit logs streaming to
   one log endpoint at a time.

   </Note>

Refer to the [Elastic
documentation](https://www.elastic.co/guide/en/observability/current/index.html)
for details on log exploration.

## Example Terraform configuration (optional)

Refer to the Terraform Registry [`hcp_vault_cluster` documentation](https://registry.terraform.io/providers/hashicorp/hcp/latest/docs/resources/vault_cluster#nested-schema-for-audit_log_config)
for more information.

```hcl
resource "hcp_vault_cluster" "example" {
  cluster_id = "vault-cluster"
  hvn_id     = hcp_hvn.example.hvn_id
  tier       = "standard_large"
  audit_log_config {
    elasticsearch_user = "actual-user"
    elasticsearch_password = "actual-password"
    elasticsearch_endpoint = "actual-url"
  }
}
```

## Edit the audit log streaming configuration (optional)

To edit a audit log streaming integration, perform the following steps.

1. From the **Audit Logs** page, click on the **Manage** drop-down, then **Edit
configuration**.

1. Edit the configuration, then click **Save**.

## Disable audit log streaming (optional)

To disable a audit log streaming integration, from the **Audit Logs** page,
click on the **Manage** drop-down, then **Disable streaming**.
