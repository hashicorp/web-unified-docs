---
page_title: Configure private network access
sidebar_title: Configure private network access
description: |-
  Configure private network access for HCP Vault Dedicated clusters with AWS or Azure.
---

# Configure private network access

Private networking with HCP Vault Dedicated requires additional configuration within your
AWS or Azure account depending on which cloud provider the cluster is deployed
in.

HashiCorp Virtual Networks (HVN) can be privately peered or attached as a spoke
to a hub network to an AWS or Azure account. The documentation covers private
connectivity options using a supported cloud service provider (CSP).

Each option involves three major steps:

1. Create the peering connection (AWS and Azure) or transit gateway attachment.
1. Configure routes between your HVN and CSP.
1. Configure security groups.

Refer to the [HVN for AWS](/hcp/docs/hcp/network/hvn-aws/hvn-aws) and [HVN for
Azure](/hcp/docs/hcp/network/hvn-azure/hvn-azure) documentation for additional
guideance.

<Tabs>
<Tab heading="Configure AWS VPC peering">

### Create peering connection request

@include '/hcp-network/configure-aws-connection.mdx'

### Complete peering connection request

@include '/hcp-network/complete-aws-connection.mdx'

### Create routes

@include '/hcp-network/create-aws-routes.mdx'

### Configure security groups

@include '/hcp-network/configure-aws-security-group.mdx'

</Tab>
<Tab heading="Configure AWS transit gateway">

### Create transit gateway attachment

@include '/hcp-network/create-aws-tgw-hcp.mdx'

### Complete transit gateway attachment

@include '/hcp-network/create-aws-tgw-web.mdx'

### Create routes

@include '/hcp-network/create-aws-routes.mdx'

### Configure security groups

@include '/hcp-network/configure-aws-security-group.mdx'

</Tab>
<Tab heading="Configure Azure VNet peering">

<Highlight>

For advanced network configuration options and considerations refer to the
[Azure hub and spoke
documentation](/hcp/docs/hcp/network/hvn-azure/hub-spoke-options).

</Highlight>

### Create peering connection request

@include '/hcp-network/configure-azure-connection.mdx'

### Complete peering connection request

@include '/hcp-network/complete-azure-connection.mdx'

### Create routes

@include '/hcp-network/create-azure-routes.mdx'

### Configure security groups

@include '/hcp-network/configure-azure-security-group.mdx'

To allow outbound traffic from your VNet, add the following rules to your
security group for HCP Vault Dedicated:

| Priority |        Name          |    Port   |  Protocol |     Source     |   Destination  | Action |
| -------- | :------------------: | :-------: | :-------: | :------------: | :------------: | :----: |
| 400      | VaultClientOutbound  | 8200      |    TCP    | VirtualNetwork |    HVN-CIDR    |  Allow |

</Tab>
</Tabs>

## HCP identity-based proxy

The HCP proxy identity-based proxy provides a publicly accessible proxy endpoint
(managed by HCP) which only allows network connections to the cluster from
authenticated and authorized HCP identities (users and service principals). This
provides an identity-based method to secure connections to the cluster's UI
publicly when IP allow list is not possible. This option can be useful for easy
access to the cluster's UI for human administrators.

To access the identity-based proxy, users must have either the Contributer or Admin role assigned.
For additional information on permissions, please review
[HCP Vault Dedicated Permissions](/hcp/docs/vault/get-started/vault-permissions).

### Access the UI using the cluster's proxy endpoint

With proxy enabled, a cluster configured with private network access can allow
organization members access their HCP Vault Dedicated clusters' UI directly from within
the portal without needing to connect through the cluster's private network.
This can be done using the "Launch web UI" button in the top-right corner of the
cluster overview page.

1. Log into the [HCP Portal](https://portal.cloud.hashicorp.com/).

1. From the **Vault clusters** page, click **Launch web UI**.

   This will launch a new browser or browser tab. Authentication through the HCP
   Proxy is transparent to the user.

   <Note>

   The URL for the Vault UI from the proxy is different than the HCP Vault Dedicated clusters
   public URL.

   </Note>

1. Paste a admin token into the **Token** textbox, or select a configured auth
   method to log in.

### Connect the Vault CLI to the cluster's proxy

<Highlight title="Requires Vault CLI 1.16">

Connecting to an HCP Vault Dedicated cluster with the CLI through the HCP Proxy address
requires the CLI to be at least version 1.16.

</Highlight>

The Vault CLI can connect to a private HCP Vault Dedicated cluster using the HCP Proxy
endpoint.

You can connect either interactively using a [HCP IAM
user](/hcp/docs/hcp/iam/users) or non-interactively using a [HCP service
principal](/hcp/docs/hcp/iam/service-principal).

<Tabs>
<Tab heading="Interactive">

1. Run `vault hcp connect` and follow prompts to choose the cluster you want to
   connect to.

   This command may open a browser and prompt you to log into HCP if your machine
   is not already authenticated. If you only have one HCP Vault Dedicated cluster, the CLI
   will automatically connect to it.

   ```shell-session
   $ vault hcp connect
   ------------------------
   Available organizations:
   Organization name: HashiCorp
   Organization name: Test-Organization
   Choose a organization:  Test-Organization
   -------------------
   Available projects:
   Project name: dev-project
   Project name: prod-project
   Choose a project:  prod-project
   -------------------
   Available clusters:
   Cluster identification: primary-cluster
   Cluster identification: replication-secondary-cluster
   Choose a cluster: primary-cluster
   Connected to cluster via an HCP proxy. Login with 'vault login' or export a VAULT_TOKEN to access this Vault cluster.
   ```

1. Set the `VAULT_NAMESPACE` environment variable to the namespace you want to log
   into and operate in.

   ```shell-session
   $ export VAULT_NAMESPACE=admin
   ```

1. Log into Vault using the `vault login` command using a configured auth method or set a
   valid `VAULT_TOKEN` as an environment variable to execute standard Vault CLI
   commands.

   ```shell-session
   $ vault login...
   ```

1. Run `vault hcp disconnect` to terminate the proxied connection from the CLI
   to the HCP Vault Dedicated cluster.

   ```shell-session
   $ vault hcp disconnect
   ```

</Tab>
<Tab heading="Non-interactive">

1. Create a [service
   principal](/hcp/docs/hcp/iam/service-principal#create-a-service-principal)
   and key in your HCP organization with Viewer role.

1. Copy the client id and client secret or set them as an environment variable
   to pass to the CLI command.

   ```shell-session
   $ export HCP_CLIENT_ID=<actual-client-id> HCP_CLIENT_SECRET=<actual-client-secret>
   ```

1. Copy the organization id and project id UUIDs which can be obtained from
   HCP portal/url or set them as an environment variable to pass tot he CLI
   command.

   ```shell-session
   $ export HCP_ORG_ID=<actual-org-id> HCP_PROJECT_ID=<actual-project-id>
   ```

1. Copy the cluster id (the name of the cluster) or set it as an environment
   variable to pass tot he CLI command.

   ```shell-session
   1. export HCP_CLUSTER_ID=<actual-cluster-id>
   ```

1. Run `vault hcp connect` and set the required context to connect to your HCP
   Vault clusterâ€™s API.

   ```shell-esssion
   vault hcp connect \
      -client-id $HCP_CLIENT_ID \
      -secret-id $HCP_CLIENT_SECRET \
      -organization-id $HCP_ORG_ID \
      -project-id $HCP_PROJECT_ID \
      -cluster-id $HCP_CLUSTER_ID
   ```

   **Example output:**

   <CodeBlockConfig hideClipboard>

   ```plaintext
   HCP Vault Cluster: vault-cluster

   Connected to cluster via an HCP proxy. Login with 'vault login' or export a VAULT_TOKEN to access this Vault cluster.
   ```

   </CodeBlockConfig>

1. Set the `VAULT_NAMESPACE` environment variable to the namespace you want to log
   into and operate in.

   ```shell-session
   $ export VAULT_NAMESPACE=admin
   ```

1. Log into Vault using the `vault login` command using a configured auth method or set a
   valid `VAULT_TOKEN` as an environment variable to execute standard Vault CLI
   commands.

   ```shell-session
   $ vault login...
   ```

1. Run `vault hcp disconnect` to terminate the proxied connection from the CLI
   to the HCP Vault Dedicated cluster.

   ```shell-session
   $ vault hcp disconnect
   ```

</Tab>
</Tabs>

## Use AWS transit gateway as a transit network

Through the supported cloud providers, you can enable common hybrid cloud
networking models to support workloads with providers not yet natively supported
by HCP using a concept known as a transit network.

Refer to the [Connect Google Cloud Platform (GCP) to HCP via AWS Transit Gateway](/vault/tutorials/cloud-ops/gcp-connect-hcp) tutorial to learn how to create a Virtual Private Network (VPN) between AWS
and Google Cloud Platform (GCP), create a transit gateway connection between HCP
and AWS, and configure routing between each of the three platforms to
demonstrate this type of connectivity.