---
page_title: Scan AWS S3 with Radar Agent
description: >-
  Scan AWS S3 buckets with on-prem Radar Agent for dumped secrets.
---

# Scan AWS S3 with Radar Agent

@include 'beta-feature.mdx'

HCP Vault Radar allows users to scan AWS S3 buckets for application data,
configuration files, backups, and other sensitive information.

## Connect AWS S3

Before you can start scanning AWS S3 buckets, you need to [deploy
the Radar agent](/hcp/docs/vault-radar/agent/deploy). Once you deploy the agent,
you can add AWS S3 as a data source.

## Prerequisites

You need one of the following AWS authentication methods:

- IAM role authentication with an EC2 instance or configured IAM role
- Environment variables authentication with AWS Access Key ID and Secret Access Key

Both authentication methods support an optional assume role ARN for
cross-account access or elevated permissions. For more information about
assuming roles, refer to the [AWS STS AssumeRole
documentation](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html).

### Required permissions

The IAM user, role, or assumed role must have the following permissions:

| Service | Permission | Documentation |
|---------|------------|---------------|
| STS | `sts:GetCallerIdentity` | [GetCallerIdentity API](https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html) |
| Account | `account:GetAccountInformation` | [GetAccountInformation API](https://docs.aws.amazon.com/accounts/latest/reference/API_GetAccountInformation.html) |
| S3 | `s3:ListAllMyBuckets` | [ListBuckets API](https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html) |
| S3 | `s3:ListBucket` | [ListObjectsV2 API](https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html) |
| S3 | `s3:GetObject` | [GetObject API](https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html) |

<Note>

`account:GetAccountInformation` is optional - the scan works without it but does not include the AWS account name on the UI for data source metadata.

</Note>

AWS lets you define IAM policies at a high level as well as very granular levels.

**Example IAM policies:**

<Tabs>
<Tab heading="Allow scanning all buckets">

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "sts:GetCallerIdentity"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListAllMyBuckets",
                "s3:ListBucket",
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::*",
                "arn:aws:s3:::*/*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "account:GetAccountInformation"
            ],
            "Resource": "*"
        }
    ]
}
```

</Tab>
<Tab heading="Allow scanning selected buckets only">

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "sts:GetCallerIdentity",
                "account:GetAccountInformation"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": "s3:ListAllMyBuckets",
            "Resource": [
                "arn:aws:s3:::*",
                "arn:aws:s3:::*/*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": "s3:ListBucket",
            "Resource": [
                "arn:aws:s3:::my-app-logs",
                "arn:aws:s3:::my-app-data",
                "arn:aws:s3:::my-app-backups"
            ]
        },
        {
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "Resource": [
                "arn:aws:s3:::my-app-logs/*",
                "arn:aws:s3:::my-app-data/*",
                "arn:aws:s3:::my-app-backups/*"
            ]
        }
    ]
}
```

</Tab>
</Tabs>

## Configure the agent for AWS S3 scanning

Set up and manage AWS S3 agent scan from the Vault Radar module in the [HCP
Portal](https://portal.cloud.hashicorp.com/). 

1. Click **Settings**.

2. Click **Data Sources**.

3. Select **Vault Radar Agent Scan** and click on **AWS S3** in the Object Storage section.

    ![Scan a New Data Source](/img/docs/vault-radar/agent/aws-s3/select-s3-data-source.png)

4. Select an AWS authentication method from the **Authentication method** pulldown menu.

5. Enter the details for the selected method and click **Next** to validate and establish the connection.

   <Tabs>
   <Tab heading="IAM Role">
   
   - Select **IAM Role** if you want to use instance profile or role-based authentication.
   
   ![IAM Role](/img/docs/vault-radar/indexing/aws-secrets-manager/iam-role.png)
   
   - (Optional) Enter an assume role ARN in the **Assume Role ARN** text field if you need to assume a different role for access.
   
   </Tab>
   <Tab heading="Environment Variables">
   
   - Select **AWS Credentials from environment variables** if you want to use access keys.
   
   ![Environment Variables](/img/docs/vault-radar/indexing/aws-secrets-manager/environment-variables.png)
   
   - Enter your AWS Access Key ID location in the **AWS Access Key ID Env variable** text field (default: `env://AWS_ACCESS_ID_LOCATION`).
   
   - Enter your AWS Secret Access Key location in the **AWS Secret Access Key Env variable** text field (default: `env://AWS_SECRET_KEY_LOCATION`).
   
   - (Optional) Enter an assume role ARN in the **Assume Role ARN** text field if you need to assume a different role for access.
   
   </Tab>
   </Tabs>

6. Choose the buckets to monitor. You can either choose all the buckets, or individual ones. Click **Finish** once done.
    ![Select Buckets](/img/docs/vault-radar/agent/aws-s3/select-buckets.png)

    <Note>
    
    Vault Radar skips buckets that do not have the `s3:GetObject` policy granted, even if you've chosen it from the list here.
    
    </Note>

7. Vault Radar scans all the secrets in the selected buckets and reports them to you.
    ![Secrets Overview](/img/docs/vault-radar/agent/aws-s3/secrets-overview.png)

8. For versioned buckets, you can also scan the previous versions of files along with the latest version. 
You can configure these settings in the Admin UI with the following flags:

- `S3_SCAN_HISTORIC_VERSIONS_ENABLED` : When this is set to true, Vault Radar scans historic versions of contents for versioned buckets.
- `S3_MAX_HISTORIC_VERSIONS` : Integer value to specify the number of historic versions to scan for a content for versioned buckets. Defaults to **20**.

    ![Admin UI](/img/docs/vault-radar/agent/aws-s3/admin-ui.png)
