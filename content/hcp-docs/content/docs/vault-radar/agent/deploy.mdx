---
page_title: Agent deploy
description: >-
  Deploy the Vault Radar agent on various platforms.
---

# Deploy Vault Radar agent

The HCP Vault Radar agent allows you to scan on-premises data sources for
secrets that are not accessible by the cloud scanner, and enable correlation
between secrets found by Vault Radar that are store in Vault Enterprise.

## Prerequisites

- Access to HCP with an account that can create service principals
- Vault Radar CLI installed
- `git` must be installed on the host machine(s) or image
- The agent requires the following environment variables to run and connect to HCP:

   - `HCP_CLIENT_ID`
   - `HCP_CLIENT_SECRET`
   - `HCP_PROJECT_ID`
   - `HCP_RADAR_AGENT_POOL_ID`

## Create a service principal

Project-level service principals interact with resources within
a specific project in an organization. By default, they can only access
resources in the same project. However, you can assign roles to service
principals projects beyond their original scope.

1. Create a [project level service principal](/hcp/docs/hcp/iam/service-principal#project-level-service-principals-1)
  with the **Vault Radar Agent** role assigned.

1. Generate a [key](/hcp/docs/hcp/iam/service-principal#generate-a-service-principal-key)
   for the service principal.

1. Export an environment variable for the client ID and client secret.

   ```shell-session
   $ export HCP_CLIENT_ID=actual-client-id HCP_CLIENT_SECRET=actual-client-secret
   ```

## Create an agent pool in the HCP Portal

An agent pool is a group of agents that share the same
`HCP_RADAR_AGENT_POOL_ID`, enabling higher throughput by horizontal scaling the
number of agents.

1. Navigate to [the HCP Portal](https://portal.cloud.hashicorp.com/) navigate to HCP Vault Radar.

1. Click **Settings**.

1. Click **Agent**.

1. Click **Add an agent pool** and follow the prompts to create a new agent
   pool.

   The final page displays the required configuration information. You can
   retrieve this information later from the **Agent** section of the settings page.

1. From the **Connect the agent** page, copy the commands to create environment
   variables for the pool ID and project ID.

   **Example:**

   <CodeBlockConfig hideClipboard>

   ```shell-session
   $ export HCP_RADAR_AGENT_POOL_ID=actual-pool-id
   export HCP_PROJECT_ID=actual-project-id
   ```

   </CodeBlockConfig>

### Configure secret values

For most data sources the agent is going to need credentials to authenticate
with the data source itself. When configuring your data source on HCP, you may
be prompted to define a credential needed for the integration to work.

<Note>

The agent is expecting a URI. The only resource supported is an
environment variable.

**Example:**

```shell-session
$ env://ENV_VARIABLE_NAME
```

</Note>

If you are configuring a GitHub data source, you are going to need to generate a
GitHub PAT for the agent. Save the value of that PAT local to the
agent as an environment variable. If you saved the environment variable as
`VAULT_RADAR_GIT_TOKEN` then the URI for that variable entered on HCP should be
`env://VAULT_RADAR_GIT_TOKEN`.

### Additional configuration

- The agent will respect configurations set by an `.hashicorp/vault-radar/ignore.yaml`.
  See [Custom ignore rules](/hcp/docs/vault-radar/cli/configuration/write-custom-ignore-rules)

- The agent will respect the log level set by the `VAULT_RADAR_LOG_LEVEL` environment
  variable. See [supported log levels](/hcp/docs/vault-radar/cli#log-level).

## Connect a data source

You can set up a data source and manage it from the Vault Radar module in the
[HCP Portal](https://portal.cloud.hashicorp.com/).

1. Click **Settings**.

1. Click **Data Sources**.

1. Click **Add data source**.

1. Select agent scan.
   ![Select agent scan](/img/docs/vault-radar/agent/onboard-agent-data-source.png)

1. Select the type of data source you want to set up. Provide the information prompted by the data source's form.
   ![Select a data source to scan](/img/docs/vault-radar/agent/agent-data-source-selection.png)

<Tabs>
<Tab heading="Kubernetes (recommended)">

@include 'vault-radar/deploy-agent-using-k8s.mdx'

</Tab>
<Tab heading="Linux">

@include 'vault-radar/run-agent-local.mdx'

</Tab>
</Tabs>
