---
page_title: Copy leaked secrets into HashiCorp Vault
description: >-
  Copy leaked secrets into HashiCorp Vault to start the remediation process.
---

# Copy leaked secrets into HashiCorp Vault

Vault Radar helps you identify leaked secrets in your code. You can start the
remediation process by copying these secrets into a Vault.

## Prerequisites

Before you begin, you need the following:

- The [HCP Vault Radar agent v0.27.0 or greater is running](/hcp/docs/vault-radar/agent/deploy) and configured
- A HashiCorp Vault Enterprise or HCP Vault Dedicated cluster [configured for the Vault Radar Agent](/hcp/docs/vault-radar/agent/correlate-vault)
- A Datasource onboarded using the HCP Vault Radar agent

<Note>

Only Agent-based data sources are supported for this feature at this time.

</Note>

## Resource Based Access Control (RBAC)

The copy secrets feature does support RBAC. A user can be assigned a **Resource Contributor** role to a specific Resource(s). When visiting the Vault Radar portal the user will only be allowed to copy secrets for the Resource(s) they have access to.

For more information on RBAC and how to configure it, see the [Configure HCP user permissions](/hcp/docs/vault-radar/get-started/configure-hcp-user-permissions) documentation.

## Vault configuration

Copying secrets into Vault requires the `create`, `patch`, and `update`
capabilities on the path where you want to copy secrets to.

This is an example policy that allows the Vault Radar agent to copy secrets to
any secrets engine mount point.

```hcl
# HCP Vault Radar agent correlation policy
path "*" {
    capabilities = ["read", "list"]
}

# HCP Vault Radar copy secrets
path "secret/+/*" {
    capabilities = ["create", "read", "list", "patch", "update"]
}
```

[Update the policy used by the Vault](https://developer.hashicorp.com/vault/docs/concepts/policies) auth method that authenticates the Vault
Radar agent with Vault.

## Configure a remediation action

Once you have the Vault Radar agent running and configured with a policy that
permits writing to Vault, you can configure Vault Radar to import secrets.

1. Log into the [HCP Portal](http://portal.cloud.hashicorp.com/sign-in)

1. Click **Vault Radar**.

1. Click **Settings**.

1. Click **Remediation**.

1. Click the **Actions** tab 

1. Click **Create actions**.
   ![Navigate to the actions page](/img/docs/vault-radar/remediation/copy-secrets/configure-remediation-actions.png)

1. Verify your desired Vault cluster is in the list and click **Next**.
   
   <Note>

   If you do not see the Vault cluster you want to use, please follow the
   instructions in the [Configure a secret
   manager](/hcp/docs/vault-radar/agent/correlate-vault) section.

   </Note>

   ![Create action for listed Vault cluster](/img/docs/vault-radar/remediation/copy-secrets/create-action-secret-manager-list.png)

1. On the **Create actions**, click **Download template** to download an example
   CSV template.
   ![Navigate to the actions page](/img/docs/vault-radar/remediation/copy-secrets/create-copy-secret-action.png)

1. Update the CSV file to match the values for your environment. The template
   includes the following columns:

   - **Resource**: The URL of one or more data sources HCP Vault Radar scans for
     leaked secrets.
   - **Secret manager:** The location of the HCP Vault Dedicated or Vault
     Enterprise cluster, and the namespace where Vault Radar will copy the secrets. [More information here.](/hcp/docs/vault-radar/remediate-secrets/copy-secrets#secret-manager)
   - **Secret manager location**: The path of the secrets engine where Vault
     Radar will copy the secrets. [More information here.](/hcp/docs/vault-radar/remediate-secrets/copy-secrets#secret-manager-location)

   <Note>
   
   Do not fill in the **Annotation** column. HCP Vault Radar uses this column 
   to provide information to users if there is a problem with the configuration.
   
   </Note>

1. Click **Choose File** and select the completed form.

1. Click **Upload and check content format**. 
   ![Successfully validated csv](/img/docs/vault-radar/remediation/copy-secrets/validate-actions-csv-validated.png)
   
   This shows you a report that includes any validation errors that may exist.
   Fix any reported errors and re-upload the form.

1. Click **Finish**.

<Warning>

The create action upload is not additive. Uploading a new form removes and
replaces earlier content with the contents of the new CSV file.

</Warning>

## Copy secrets to secret manager

With the Vault Radar actions configured, you can begin copying secrets into Vault.

1. Navigate to the **Events** page and select one or more events you'd like to remediate.
   ![Select events to remediate](/img/docs/vault-radar/remediation/copy-secrets/unremediated-event-selected.png)

1. Select the **Store in secret manager** button to open a flyout menu.
   ![Set the key for the secret](/img/docs/vault-radar/remediation/copy-secrets/copy-secret-flyout.png)

1. Populate the flyout menu with one or more key names for the selected events.

1. Verify the **Store at** location for the target secret manager. You can edit
   the value if you want to store the secret in a different location.
   ![Location is
   editable](/img/docs/vault-radar/remediation/copy-secrets/copy-secret-flyout-edit-location.png)
   
   <Note>

   If you edit the **Store at** location, be sure the assoicated Vault policy
   allows write access to that path.

   </Note>

1. Click **Confirm** to start the copy operation.

   The copying will happen in the background. A notification banner should
   appear at the top of the page to indicate the operation was successful.

1. Select a remediated event to see the managed location fields. You can also
   view the secret in Vault to confirm it was copied to the defined path.
  ![Example remediated event](/img/docs/vault-radar/remediation/copy-secrets/remediated-event.png)

### Resource

The resource column is expecting a URI to a data source.

For git repositories, expects a URL including the protocol, domain, and
respository.

<CodeBlockConfig hideClipboard>

```plaintext
git://<domain/path-to-repository>/<repository-name>.git
```

</CodeBlockConfig>

**Example:**

<CodeBlockConfig hideClipboard>

```plaintext
git://github.com/hashicorp/vault.git
```

</CodeBlockConfig>

### Secret manager

The secret manager column expects a URI to a secret manager configured,
including the port and namespace.

<CodeBlockConfig hideClipboard>

```plaintext
vault://<vault-cluster-url>:8200/<namespace>
```

</CodeBlockConfig>

**Example:**

<CodeBlockConfig hideClipboard>

```plaintext
vault://vault-cluster.hashicorp.com:8200/admin
```

</CodeBlockConfig>

<Note>

This should be the same URI location shown on **Remediation > Actions** page.

</Note>

### Secret manager location

The secret manager location column is expecting a delimited string that is going
to act as the top level directory for any secret that is copied and belongs to
the resource defined in the first column.

The string needs to be in the format:

<Note>

`kv/` and `/secret-path/` are required delimiters.

</Note>

<Note>

You must create the mount path before copying secrets to Vault. The path to the secret does not have to exist. Pay attention to casing, as the path is case-sensitive.

</Note>

<CodeBlockConfig hideClipboard>

```plaintext
kv/<mount-path>/secret-path/<path-to-secret>
```

</CodeBlockConfig>

**Example:**

<CodeBlockConfig hideClipboard>

```
kv/secret/secret-path/secrets-for-resource
```

</CodeBlockConfig>
