### Initiate peering connection

1. Click **HashiCorp Virtual Network** in the left navigation menu.

1. Select the HVN you want to create a peering connection with.

1. In the selected HVN overview page, click **Peering connections**.

   If you have peering connections available, they are listed in the center of the screen.

1. Click **Create connection**.

1. Select the **Manual peering using AWS CLI** radio button.

1. Fill in the requested information and click the **Create connection** button to begin the peering process.

   <Note>

   If you are unsure of where to find the AWS Account ID or the VPC ID, click on
   the link labeled **Where can I find this?**. The link provides helpful
   information and a screenshot of where in the AWS Console this information can
   be found.

   </Note>

### Accept peering connection

The newly created peering connection is in the _pending_ state. You can accept the connection using the AWS CLI.

1. Copy the code snippet under **Acceptance instructions** and run it in a terminal with the AWS CLI configured for the desired AWS account.

   **Example output:**

   <CodeBlockConfig hideClipboard>

   ```plaintext
   {
       "VpcPeeringConnection": {
           "AccepterVpcInfo": {
               "CidrBlock": "172.31.0.0/16",
               "CidrBlockSet": [
                   {
                       "CidrBlock": "172.31.0.0/16"
                   }
               ],
               "OwnerId": "734750226488",
               "PeeringOptions": {
                   "AllowDnsResolutionFromRemoteVpc": false,
                   "AllowEgressFromLocalClassicLinkToRemoteVpc": false,
                   "AllowEgressFromLocalVpcToRemoteClassicLink": false
               },
               "VpcId": "vpc-8vgu9gugu9090g",
               "Region": "us-west-2"
           },
           "RequesterVpcInfo": {
               "CidrBlock": "172.25.16.0/20",
               "CidrBlockSet": [
                   {
                       "CidrBlock": "172.25.16.0/20"
                   }
               ],
               "OwnerId": "676562983947",
               "VpcId": "vpc-8vgu9gugu9090g",
               "Region": "us-west-2"
           },
           "Status": {
               "Code": "provisioning",
               "Message": "Provisioning"
           },
           "Tags": [],
           "VpcPeeringConnectionId": "pcx-uiovg9f79vu"
       }
   }
   ```

   </CodeBlockConfig>

   1. Wait for the stepper to move to the **Configure** step before proceeding.

### Update security groups

Update the relevant [security
groups](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html)
in the target VPC by adding the following rules allowing ingress and egress for
the CIDR block of HVN. These rules are valid for applications that are accessing
your cluster (DNS and API) via localhost, but your configuration might need to
differ.

**NOTE:** Refer to the [AWS official
documentation](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/working-with-security-groups.html#updating-security-group-rules)
or [the HCP Portal](https://portal.cloud.hashicorp.com/) help instruction.

<Tabs>
<Tab heading="HCP Vault Dedicated">

1. From the AWS console, navigate to security groups and copy the **Security group ID** you wish to update.

1. Return to [the HCP Portal](https://portal.cloud.hashicorp.com/), the peering workflow has moved to the **Configure** step.

1. Enter the security group ID you copied from the AWS console in the **AWS security group ID** textbox.

1. Copy the **Outbound rules** CLI command and run it in a terminal with the AWS CLI configured for the desired AWS account.

</Tab>
<Tab heading="HCP Consul Dedicated">

1. From the AWS console, navigate to security groups and copy the **Security group ID** you wish to update.

1. Return to [the HCP Portal](https://portal.cloud.hashicorp.com/), the peering workflow has moved to the **Configure** step.

1. Enter the security group ID you copied from the AWS console in the **AWS security group ID** textbox.

1. Click the **Consul snippets** tab.

1. Copy the **Inbound rules** CLI command and run it in a terminal with the AWS CLI configured for the desired AWS account.

1. Return to [the HCP Portal](https://portal.cloud.hashicorp.com/), copy the **Outbound rules** CLI command and run it in a terminal with the AWS CLI configured for the desired AWS account.

</Tab>
</Tabs>

### Update AWS route table

For compute resources to take advantage of the logical network path enabled by the peering connection, a network route must be added to the VPC's routing table.
The route table entry directs compute resources to the HashiCorp Cloud Platform (HCP) network. Without a route entry in the VPC's route table, those compute resources cannot connect to HashiCorp Cloud Platform (HCP) resources.

1. Return to the AWS console. Navigate to **Route tables** and copy the **Route table ID** you wish to update.

1. Return to [the HCP Portal](https://portal.cloud.hashicorp.com/) and click **2. Update route table**.

1. Enter the route table ID you copied from the AWS console in the **AWS target VPC route table ID** textbox.

1. Copy the code snippet and run it in a terminal with the AWS CLI configured for the desired AWS account.

   **Example code snippet:**

   <CodeBlockConfig hideClipboard>

   ```shell-session
   $ aws ec2 --region
       us-west-2
       create-route --route-table-id
       rtb-043ec68d39469bf17
       --destination-cidr-block
       172.25.16.0/20
       --vpc-peering-connection-id
       pcx-07504abe35f63e360
   ```

   </CodeBlockConfig>