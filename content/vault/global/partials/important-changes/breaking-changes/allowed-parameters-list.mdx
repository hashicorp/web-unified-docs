### Item-by-item list comparison for allowed_parameters and denied_parameters ((#allowed-parameters-list))

| Change       | Affected version | Vault edition
| ------------ | ---------------- | -------------
| Breaking     | 1.21.0+          | All

Previous versions of Vault only matched list parameters when the associated
policy defined the list as a whole. As a result, Vault allowed lists containing
denied values as long as the policy did not deny that exact list and denied
lists containing allowed values because the policy did not allow the exact list.

Vault now checks each value in a list parameter against allowed/denied values
in the applicable Vault policy and allows or denies requests if the policy
defines the list as a whole or every/any individual element of the list. For
example, if the request includes a list like `['a', 'b', 'c']`, it still matches
to a policy that includes `['a', 'b', 'c']` but also matches to an approve
policy that includes all the individual values `a`, `b`, and `c` or a deny
policy that includes any of the individual values.

#### Recommendation

Workflows that previously succeeded may now fail due to permission checks
involving `denied_parameters` because the new matching behavior correctly
identifies the fact that the list contains individually denied values even when
the exact list does not appear in the policy.

To address the broken workflow:
- Check whether or not your policies are overly restrictive.
- Update your workflows to avoid including explicitly denied values in lists.

Refer to [list parameter evaluation](/vault/docs/concepts/policies#list-parameter-evaluation) for more information.

You can temporarily revert to the deprecated matching behavior by setting the
`VAULT_LEGACY_EXACT_MATCHING_ON_LIST` environment variable on your Vault server.
