---
layout: docs
page_title: Deploy Vault on Amazon EKS
description: >-
  Guide to deploying and setting up Vault on Amazon EKS.
---

# Deploy Vault on Amazon EKS

Amazon Elastic Kubernetes Service (EKS) can run and scale Vault in the Amazon Web Services (AWS) cloud or on-premises. Amazon EKS is a managed Kubernetes service that makes it easy to run Kubernetes without needing to install and operate your own Kubernetes control plane or nodes.

In this guide, you create an EKS cluster in AWS, deploy a MySQL server, install Vault in high-availability (HA) mode via the Helm chart. Then you configure the authentication between Vault and the cluster. 

This guide focuses on setting up HashiCorp Vault on Amazon EKS and assumes a understanding of both Amazon EKS concepts and terminology. The guide assumes the user is familiar with AWS accounts, EKS clusters, Kubernetes pods, service accounts, and manifests.

## Before you start

This guide requires:

- You should be familiar with Kubernetes concepts like pods, service accounts,
  and manifests.
- You should be comfortable working with:
   - [Amazon EKS](https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html).
   - [Helm charts](https://helm.sh/docs/topics/charts).
- You must have an [AWS account](https://aws.amazon.com/account/) 
- You must haver the following command-line tools installed and configured:
   - [AWS command-line interface (CLI)](https://aws.amazon.com/cli/)
   - [Amazon EKS CLI](https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html) 
   - [Kubernetes CLI](https://kubernetes.io/docs/tasks/tools/install-kubectl/)
   - [Helm CLI](https://helm.sh/docs/helm/)
- [jq](https://jqlang.org/)
- You will need a SSH key pair to access the nodes in your cluster. You can create a key pair using the AWS Management Console or the AWS CLI. For more information, see [Create a key pair for Amazon EC2 instances](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/create-key-pairs.html).

## Step 1: Add the HashiCorp repository to Helm

@include 'how-tos/helm-repo.mdx'

## Step 2: Start EKS cluster

A high availability Vault cluster that requires a Kubernetes cluster with three nodes.

1. Log in to your AWS account with the AWS CLI.

1. Create a three node cluster named `learn-vault`.

   ```shell-session
   $ eksctl create cluster \
       --name learn-vault \
       --nodes 3 \
       --with-oidc \
       --ssh-access \
       --ssh-public-key learn-vault \
       --managed
   ```

1. MySQL needs EBS volume type to use a the `gp2` storage class as the default. Patch the default storage class with the following command.

   ```shell-session
   $ kubectl patch storageclass gp2 -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'
   ```

1. Once all the nodes are in `Ready` status, enable volume support with the [EBS CSI driver add-on](https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html).

   ```shell-session
   $ eksctl create iamserviceaccount \
       --name ebs-csi-controller-sa \
       --namespace kube-system \
       --cluster learn-vault \
       --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy \
       --approve \
       --role-only \
       --role-name AmazonEKS_EBS_CSI_DriverRole
   ```
   
1. Run the following command to create the add-on:

   ```shell-session
   $ eksctl create addon \
       --name aws-ebs-csi-driver \
       --cluster learn-vault \
       --service-account-role-arn arn:aws:iam::$(aws sts get-caller-identity --query Account --output text):role/AmazonEKS_EBS_CSI_DriverRole
   ```

## Step 3: Install Vault using helm

@include 'how-tos/helm-install.mdx'

## Step 4: Initialize and unseal the primary Vault pod

@include 'how-tos/initialise.mdx'

## Step 5: Join additional nodes to the Vault cluster

@include 'how-tos/join.mdx'

## Step 6: Test your cluster deployment 

@include 'how-tos/test.mdx'

## Step 7: Create a Kubernetes service account for clients

@include 'how-tos/kubernetes/sa.mdx'

## Step 8: Enable Kubernetes authentication

@include 'how-tos/kubernetes/auth.mdx'

## Step 9: Validate secret available to sample application

@include 'how-tos/validate.mdx'

## Step 10: Clean up

Destroy the cluster.

```shell-session
$ eksctl delete cluster --name learn-vault
```

## Next steps

@include 'how-tos/next-steps.mdx'

## Additional resources

@include 'how-tos/additional-resources.mdx'
