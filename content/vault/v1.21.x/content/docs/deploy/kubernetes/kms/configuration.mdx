---
layout: docs
page_title: Configuration
description: Configuration parameters for the Vault Kubernetes KMS v2 plugin.
---

# Configuration

This page documents the configuration parameters for the Vault Kubernetes KMS v2
plugin. These parameters control how the plugin exposes its KMS v2 gRPC
endpoint to Kubernetes, connects to Vault, authenticates, selects a Transit key,
and emits logs and metrics.

Configuration is provided to the plugin at startup using command-line flags.
The plugin validates configuration on startup and exits if required parameters
are missing or invalid.

---

## Parameters

- `listen-address` `(string: "unix:///tmp/vault-kube-kms.socket")` – The
  Unix domain socket address where the plugin listens for requests from
  the Kubernetes API server. The kube-apiserver must have filesystem access
  to this socket in order to communicate with the plugin.

  Environment Variable : `VAULT_KUBE_KMS_LISTEN_ADDRESS`

- `vault-address` `(string: <required>)` – The HTTP(S) API address of the Vault
  server.The plugin connects to this address to authenticate and perform cryptographic
  operations using the Vault Transit secrets engine.

  This value must be a non-empty string and must be reachable from the node where
  the plugin runs.

  Environment Variable : `VAULT_KUBE_KMS_VAULT_ADDRESS`

- `vault-namespace` `(string: "")` – The Vault namespace in which the plugin operates.
  If unset, the plugin uses the root namespace.

  This parameter is required when using Vault Enterprise with namespaces enabled.

  Environment Variable: `VAULT_KUBE_KMS_VAULT_NAMESPACE`

- `transit-mount` `(string: "transit")` – The mount path of the Vault Transit
  secrets engine used by the plugin to encrypt and decrypt data encryption keys (DEKs).

  This value must be a non-empty string and must reference an existing Transit
  mount in Vault.

  Environment Variable: `VAULT_KUBE_KMS_TRANSIT_MOUNT`

- `transit-key-name` `(string: "kms")` – The name of the Vault Transit key used
  by the plugin to encrypt and decrypt DEKs. The key must already exist in Vault.

  The plugin’s Vault policy must grant permission to use this key for encryption
  and decryption operations.

  Environment Variable: `VAULT_KUBE_KMS_TRANSIT_KEY`

- `log-level` `(string: "info")` – Log verbosity level.
  Supported values (in order of descending detail) are `trace`, `debug-extended`,
  `debug`, `info`, and `error`

  Environment Variable: `VAULT_KUBE_KMS_LOG_LEVEL`

- `auth-method` `(string: "appRole")` – The Vault authentication method used by the plugin.
  Supported values are `approle`.

  Environment Variable: `VAULT_KUBE_KMS_AUTH_METHOD`

- `vault-ca` `(string: "")` – Path to a CA certificate file for validating Vault's TLS certificate.
  If not set, the system trust store is used.

  Environment Variable: `VAULT_KUBE_KMS_VAULT_CA`

- `skip-tls-verify` `(bool: false)` – Skip TLS certificate verification when connecting to Vault.
  Not for production use.

  Environment Variable: `VAULT_KUBE_KMS_TLS_SKIP_VERIFY`

- `vault-tls-server-name` `(string: "")` – SNI (Server Name Indication) to use when connecting to
  Vault via TLS

  Environment Variable: `VAULT_KUBE_KMS_VAULT_TLS_SERVER_NAME`
---

## Authentication parameters

### Approle

When using Approle, the following parameters are required.

- `approle-role-id` `(string: "")` – The AppRole Role ID used to authenticate
  to Vault. This value is not sensitive and can be provided directly as a flag.

  Environment variable: `VAULT_KUBE_KMS_APPROLE_ROLE_ID`

- `approle-secret-id-path` `(string: "")` – The filesystem path to a file
  containing the AppRole Secret ID. This value is sensitive and should be protected
  using appropriate filesystem permissions.

  The plugin reads the Secret ID from this file at startup.

  Environment variable: `VAULT_KUBE_KMS_APPROLE_SECRET_ID_PATH`

---

## Metrics and telemetry parameters

- `metrics-port` `(int: 9090)` – The local TCP port where the plugin exposes a
  Prometheus-compatible `/metrics` endpoint. The endpoint binds to `localhost`.

  If unset, the plugin does not expose a metrics endpoint.

  Environment variable: `VAULT_KUBE_KMS_METRICS_PORT`

- `enable-runtime-metrics` `(bool: false)` – Controls whether Go runtime and
  process-level metrics are exposed alongside plugin metrics.

  When enabled, the `/metrics` endpoint includes metrics such as garbage
  collection statistics, goroutine counts, and memory usage.

  Environment variable: `VAULT_KUBE_KMS_ENABLE_RUNTIME_METRICS`

---

## Minimal configuration example

```text
--listen-address=/var/run/kms/vault-kms.sock
--vault-address=https://vault.example.com:8200
--transit-mount=transit
--transit-key-name=kubernetes-etcd
--auth-method=approle
--approle-role-id=example-role-id
--approle-secret-id-path=/var/run/secrets/vault/secret-id
```
