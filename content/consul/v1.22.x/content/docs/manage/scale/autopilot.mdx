---
layout: docs
page_title: Consul Autopilot
description: >-
  Use Autopilot features to monitor the Raft cluster, introduce stable servers, and clean up dead servers.
---

# Consul Autopilot

This page describes Consul Autopilot, which supports automatic, operator-friendly management of Consul servers. Autopilot helps maintain the health and stability of the Consul server cluster by monitoring server health, introducing stable servers, and cleaning up dead servers. Furthermore, Consul Enterprise customers can leverage two additional Autopilot features, namely redundancy zones and automated upgrades to enhance datacenter resiliency and simplify operations.

## Overview

Autopilot includes the following features:
- [Server health checking](#server-health-checking)
- [Server stabilization time](#server-stabilization-time)
- [Dead server cleanup](#dead-server-cleanup)
- [Redundancy zones (only available in Consul Enterprise)](#redundancy-zones)
- [Automated upgrades (only available in Consul Enterprise)](#automated-upgrades)

### Default configuration

You can check the default Autopilot values using the `consul operator` CLI command or using the [`/v1/operator/autopilot` endpoint](/consul/api-docs/operator/autopilot)

<Tabs>
<Tab heading="CLI command">

```shell-session
$ consul operator autopilot get-config
```

```plaintext hideClipboard
CleanupDeadServers = true
LastContactThreshold = 200ms
MaxTrailingLogs = 250
MinQuorum = 0
ServerStabilizationTime = 10s
RedundancyZoneTag = ""
DisableUpgradeMigration = false
UpgradeVersionTag = ""
```

</Tab>
<Tab heading="API call using cURL">

```shell-session
$ curl http://127.0.0.1:8500/v1/operator/autopilot/configuration
```

```json
{
  "CleanupDeadServers": true,
  "LastContactThreshold": "200ms",
  "MaxTrailingLogs": 250,
  "MinQuorum": 0,
  "ServerStabilizationTime": "10s",
  "RedundancyZoneTag": "",
  "DisableUpgradeMigration": false,
  "UpgradeVersionTag": "",
  "CreateIndex": 5,
  "ModifyIndex": 5
}
```

</Tab>
</Tabs>

Changes to the Autopilot configuration are persisted in the Raft database maintained by the Consul servers. This means that Autopilott configuration will be included in the Consul snapshot data.

## Workflow

### Server health checking

An internal health check runs on the leader to track the stability of servers. A server is considered healthy if all of the following conditions are true.

- It has a SerfHealth status of 'Alive'.
- The time since its last contact with the current leader is below `LastContactThreshold` (that by default is `200ms`).
- Its latest Raft term matches the leader's term.
- The number of Raft log entries it trails the leader by does not exceed `MaxTrailingLogs` (that by default is `250`).

The status of these health checks can be viewed through the `/v1/operator/autopilot/health` HTTP endpoint, with a top level `Healthy` field indicating the overall status of the datacenter:

```shell-session
$ curl localhost:8500/v1/operator/autopilot/health | jq .
```

```json
{
  "Healthy": true,
  "FailureTolerance": 1,
  "Servers": [
    {
      # ...
      "Name": "server-dc1-1",
      "Address": "10.20.10.11:8300",
      "SerfStatus": "alive",
      "Version": "1.7.2",
      "Leader": false,
			# ...
      "Healthy": true,
      "Voter": true,
      # ...
    },
    {
      # ...
      "Name": "server-2",
      "Address": "10.20.10.12:8300",
      "SerfStatus": "alive",
      "Version": "1.7.2",
      "Leader": false,
      # ...
      "Healthy": true,
      "Voter": true,
      # ...
    },
    {
      # ...
      "Name": "server-3",
      "Address": "10.20.10.13:8300",
      "SerfStatus": "alive",
      "Version": "1.7.2",
      "Leader": false,
      # ...
      "Healthy": true,
      "Voter": false,
      # ...
    }
  ]
}
```

## Server stabilization time

When a new server is added to the datacenter, there is a waiting period where it must be healthy and stable for a certain amount of time before being promoted to a full, voting member. This is defined by the `ServerStabilizationTime`, Autopilot's parameter, and by default is 10 seconds.

In case your configuration requires a different amount of time, you can tune the parameter and assign it a different duration.

```shell-session
$ consul operator autopilot set-config -server-stabilization-time=15s
Configuration updated!
```

Use the `get-config` command to check the configuration.

```shell-session
$ consul operator autopilot get-config
CleanupDeadServers = true
LastContactThreshold = 200ms
MaxTrailingLogs = 250
MinQuorum = 0
ServerStabilizationTime = 15s
RedundancyZoneTag = ""
DisableUpgradeMigration = false
UpgradeVersionTag = ""
```

### Dead server cleanup

If Autopilot is disabled, it will take 72 hours for dead servers to be automatically reaped, or an operator must manually issue the `consul force-leave <dead-server-name>` command. If another server failure occurred it could jeopardize the quorum, even if the failed Consul server had been automatically replaced. Autopilot helps prevent these kinds of outages by quickly removing failed servers as soon as a replacement Consul server comes online. When servers are removed by the cleanup process they will enter the "left" state.

With Autopilot's dead server cleanup enabled, dead servers will periodically be cleaned up and removed from the Raft peer set to prevent them from interfering with the quorum size and leader elections. The cleanup process will also be automatically triggered whenever a new server is successfully added to the datacenter.

We suggest leaving the feature enabled to avoid faulty nodes remaining in the Raft pool for too long without the need for manual pruning. In test scenarios or in environments you can disable the faulty node pruning by using the `consul operator autopilot set-config -cleanup-dead-servers=false` command.

## Enterprise features

To further strengthen and automate Consul operations, there are two more Autopilot features in Consul Enterprise that customers can take advantage of to improve their datacenter resiliency and to simplify operations.

### Redundancy zones

Consul’s redundancy zones provide high availability in the case of server failure through the Enterprise feature of Autopilot. Autopilot allows you to add read replicas to your datacenter that will be promoted to the "voting" status in case of voting server failure.

You can utilise redundancy zones to implement isolated failure domains such as AWS Availability Zones (AZ), and therefore to obtain redundancy within an AZ without having to sustain the overhead of a large quorum.

Check [provide fault tolerance with redundancy zones](/consul/docs/manage/scale/redundancy-zone) to learn more on the functionality.

### Automated upgrades

Consul’s automatic upgrades provide a simplified way to upgrade existing Consul datacenter. This functionally is provided through the Enterprise feature of Autopilot. Autopilot allows you to add new servers directly to the datacenter and waits until you have enough servers running the new version to perform a leadership change and demote the old servers as "non-voters".

Check [automate upgrades with Consul Enterprise](/consul/docs/upgrade/automated) to learn more on the functionality.

## Next steps

To read further about [Autopilot](/consul/docs/manage/scale/autopilot) functionality, check the [read replicas](/consul/docs/manage/scale/read-replica) and [redundancy zones](/consul/docs/manage/scale/redundancy-zone) pages.

To learn more about operational Autopilot settings regarding stability, check the [last_contact_threshold](/consul/docs/reference/agent/configuration-file/bootstrap#last_contact_threshold) and [max_trailing_logs](/consul/docs/reference/agent/configuration-file/bootstrap#max_trailing_logs) parameters in the Consul agent configuration documentation.